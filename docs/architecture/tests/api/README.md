# api tests

API ç«¯ç‚¹é›†æˆæµ‹è¯•ï¼ŒéªŒè¯ REST API çš„æ­£ç¡®æ€§ã€‚

## ğŸ§… ç¬¬ä¸€å±‚ï¼šåœ¨ Tests ä¸­çš„ä½ç½®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          burncloud-tests                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚                        æµ‹è¯•æ¨¡å—                                     â”‚    â”‚
â”‚   â”‚                                                                     â”‚    â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚   â”‚   â”‚ common          â”‚  â”‚â˜…api tests       â”‚  â”‚ ui tests        â”‚    â”‚    â”‚
â”‚   â”‚   â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚    â”‚    â”‚
â”‚   â”‚   â”‚ æœåŠ¡å™¨å¯åŠ¨      â”‚  â”‚ API ç«¯ç‚¹æµ‹è¯•   â”‚  â”‚ UI æ¸²æŸ“æµ‹è¯•     â”‚    â”‚    â”‚
â”‚   â”‚   â”‚ æµ‹è¯•é…ç½®        â”‚  â”‚ é›†æˆæµ‹è¯•       â”‚  â”‚ ç»„ä»¶æµ‹è¯•        â”‚    â”‚    â”‚
â”‚   â”‚   â”‚ è¾…åŠ©å‡½æ•°        â”‚  â”‚                 â”‚  â”‚                 â”‚    â”‚    â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚   â”‚                                                                     â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

api tests çš„èŒè´£:
â”œâ”€â”€ éªŒè¯ REST API ç«¯ç‚¹
â”œâ”€â”€ æµ‹è¯•è®¤è¯å’Œæˆæƒ
â”œâ”€â”€ æµ‹è¯•æ•°æ® CRUD æ“ä½œ
â””â”€â”€ æµ‹è¯•è·¯ç”±å’Œä¸­ç»§åŠŸèƒ½
```

## ğŸ§… ç¬¬äºŒå±‚ï¼šæ–‡ä»¶ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       api tests æ–‡ä»¶ç»“æ„                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  crates/tests/tests/api/                                                     â”‚
â”‚  â”‚                                                                           â”‚
â”‚  â”œâ”€â”€ mod.rs              # æ¨¡å—å…¥å£                                         â”‚
â”‚  â”œâ”€â”€ auth.rs             # è®¤è¯æµ‹è¯•                                         â”‚
â”‚  â”œâ”€â”€ auth_handlers.rs    # è®¤è¯å¤„ç†å™¨æµ‹è¯•                                   â”‚
â”‚  â”œâ”€â”€ channel.rs          # é€šé“ç®¡ç†æµ‹è¯•                                     â”‚
â”‚  â”œâ”€â”€ ability_routing.rs  # èƒ½åŠ›è·¯ç”±æµ‹è¯•                                     â”‚
â”‚  â”œâ”€â”€ monitor.rs          # ç›‘æ§ API æµ‹è¯•                                    â”‚
â”‚  â”œâ”€â”€ user.rs             # ç”¨æˆ· API æµ‹è¯•                                    â”‚
â”‚  â”œâ”€â”€ relay.rs            # ä¸­ç»§æµ‹è¯•                                         â”‚
â”‚  â”œâ”€â”€ claude_relay.rs     # Claude ä¸­ç»§æµ‹è¯•                                  â”‚
â”‚  â”œâ”€â”€ log.rs              # æ—¥å¿— API æµ‹è¯•                                    â”‚
â”‚  â””â”€â”€ status.rs           # çŠ¶æ€ API æµ‹è¯•                                    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§… ç¬¬ä¸‰å±‚ï¼šæµ‹è¯•æ–‡ä»¶è¯¦è§£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          æµ‹è¯•æ–‡ä»¶è¯¦è§£                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  auth.rs - è®¤è¯æµ‹è¯•                                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                        â”‚
â”‚  â”œâ”€â”€ æµ‹è¯•ç”¨æˆ·ç™»å½•                                                           â”‚
â”‚  â”œâ”€â”€ æµ‹è¯• Token éªŒè¯                                                        â”‚
â”‚  â”œâ”€â”€ æµ‹è¯•æ— æ•ˆ Token å¤„ç†                                                    â”‚
â”‚  â””â”€â”€ æµ‹è¯•æƒé™æ£€æŸ¥                                                           â”‚
â”‚                                                                              â”‚
â”‚  channel.rs - é€šé“ç®¡ç†æµ‹è¯•                                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                   â”‚
â”‚  â”œâ”€â”€ æµ‹è¯•é€šé“åˆ›å»º                                                           â”‚
â”‚  â”œâ”€â”€ æµ‹è¯•é€šé“æ›´æ–°                                                           â”‚
â”‚  â”œâ”€â”€ æµ‹è¯•é€šé“åˆ é™¤                                                           â”‚
â”‚  â””â”€â”€ æµ‹è¯•é€šé“åˆ—è¡¨æŸ¥è¯¢                                                       â”‚
â”‚                                                                              â”‚
â”‚  ability_routing.rs - èƒ½åŠ›è·¯ç”±æµ‹è¯•                                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                             â”‚
â”‚  â”œâ”€â”€ æµ‹è¯•æ¨¡å‹-é€šé“æ˜ å°„                                                      â”‚
â”‚  â”œâ”€â”€ æµ‹è¯•è·¯ç”±é€‰æ‹©é€»è¾‘                                                       â”‚
â”‚  â””â”€â”€ æµ‹è¯•è´Ÿè½½å‡è¡¡                                                           â”‚
â”‚                                                                              â”‚
â”‚  monitor.rs - ç›‘æ§ API æµ‹è¯•                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                    â”‚
â”‚  â”œâ”€â”€ æµ‹è¯•ç³»ç»ŸæŒ‡æ ‡è·å–                                                       â”‚
â”‚  â”œâ”€â”€ æµ‹è¯• CPU/å†…å­˜/ç£ç›˜ç›‘æ§                                                 â”‚
â”‚  â””â”€â”€ æµ‹è¯•å¥åº·æ£€æŸ¥ç«¯ç‚¹                                                       â”‚
â”‚                                                                              â”‚
â”‚  relay.rs - ä¸­ç»§æµ‹è¯•                                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                            â”‚
â”‚  â”œâ”€â”€ æµ‹è¯•è¯·æ±‚è½¬å‘                                                           â”‚
â”‚  â”œâ”€â”€ æµ‹è¯•å“åº”å¤„ç†                                                           â”‚
â”‚  â”œâ”€â”€ æµ‹è¯•æµå¼å“åº”                                                           â”‚
â”‚  â””â”€â”€ æµ‹è¯•é”™è¯¯å¤„ç†                                                           â”‚
â”‚                                                                              â”‚
â”‚  user.rs - ç”¨æˆ· API æµ‹è¯•                                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                       â”‚
â”‚  â”œâ”€â”€ æµ‹è¯•ç”¨æˆ· CRUD                                                          â”‚
â”‚  â”œâ”€â”€ æµ‹è¯•ä½™é¢æ“ä½œ                                                           â”‚
â”‚  â””â”€â”€ æµ‹è¯• Token ç®¡ç†                                                        â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§… ç¬¬å››å±‚ï¼šæµ‹è¯•æ¨¡å¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          æµ‹è¯•æ¨¡å¼                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  1. ç«¯åˆ°ç«¯æµ‹è¯• (E2E)                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  #[tokio::test]                                                      â”‚   â”‚
â”‚  â”‚  async fn test_api_endpoint() {                                      â”‚   â”‚
â”‚  â”‚      let base_url = spawn_app().await;                               â”‚   â”‚
â”‚  â”‚      let client = reqwest::Client::new();                            â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚      let response = client                                           â”‚   â”‚
â”‚  â”‚          .get(&format!("{}/api/status", base_url))                   â”‚   â”‚
â”‚  â”‚          .send()                                                     â”‚   â”‚
â”‚  â”‚          .await                                                      â”‚   â”‚
â”‚  â”‚          .unwrap();                                                  â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚      assert!(response.status().is_success());                       â”‚   â”‚
â”‚  â”‚  }                                                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  2. è®¤è¯æµ‹è¯•                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  let token = get_root_token();                                       â”‚   â”‚
â”‚  â”‚  let response = client                                               â”‚   â”‚
â”‚  â”‚      .get(&format!("{}/api/protected", base_url))                    â”‚   â”‚
â”‚  â”‚      .bearer_auth(&token)                                            â”‚   â”‚
â”‚  â”‚      .send()                                                         â”‚   â”‚
â”‚  â”‚      .await                                                          â”‚   â”‚
â”‚  â”‚      .unwrap();                                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  3. å¤–éƒ¨ API æµ‹è¯• (éœ€è¦ç¯å¢ƒå˜é‡)                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  let Some((key, url)) = get_openai_config() else {                   â”‚   â”‚
â”‚  â”‚      println!("Skipping: no OpenAI config");                         â”‚   â”‚
â”‚  â”‚      return;                                                         â”‚   â”‚
â”‚  â”‚  };                                                                  â”‚   â”‚
â”‚  â”‚  // ä½¿ç”¨çœŸå® API æµ‹è¯•                                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§… ä¾èµ–å…³ç³»

```
api tests
â”œâ”€â”€ tests/common
â”‚   â””â”€â”€ spawn_app, get_root_token
â””â”€â”€ external
    â”œâ”€â”€ tokio            # å¼‚æ­¥è¿è¡Œæ—¶
    â””â”€â”€ reqwest          # HTTP å®¢æˆ·ç«¯
```
