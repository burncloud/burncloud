# burncloud-common

å…±äº«ç±»å‹å’Œå·¥å…·ï¼Œè¢«æ‰€æœ‰ crate ä¾èµ–ã€‚

## ğŸ§… ç¬¬ä¸€å±‚ï¼šç³»ç»Ÿä¸­çš„ä½ç½®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          BurnCloud ä¾èµ–å±‚çº§                                  â”‚
â”‚                                                                              â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚                          â”‚  burncloud      â”‚                                â”‚
â”‚                          â”‚  (ä¸»ç¨‹åºå…¥å£)    â”‚                                â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                   â”‚                                          â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚         â”‚                         â”‚                         â”‚               â”‚
â”‚         â–¼                         â–¼                         â–¼               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ burncloud-    â”‚        â”‚ burncloud-    â”‚        â”‚ burncloud-    â”‚       â”‚
â”‚  â”‚   server      â”‚        â”‚   router      â”‚        â”‚   client      â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚          â”‚                        â”‚                        â”‚               â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                   â”‚                                          â”‚
â”‚                                   â–¼                                          â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚                    â”‚      burncloud-common        â”‚                         â”‚
â”‚                    â”‚        â˜… å½“å‰                â”‚                         â”‚
â”‚                    â”‚                              â”‚                         â”‚
â”‚                    â”‚  æ‰€æœ‰ crate çš„å…±äº«åŸºç¡€        â”‚                         â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                                   â”‚                                          â”‚
â”‚                                   â–¼                                          â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚                    â”‚      å¤–éƒ¨ä¾èµ–                â”‚                         â”‚
â”‚                    â”‚  serde / serde_json         â”‚                         â”‚
â”‚                    â”‚  thiserror                  â”‚                         â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Common çš„èŒè´£:
â”œâ”€â”€ å®šä¹‰æ‰€æœ‰ crate å…±ç”¨çš„æ•°æ®ç±»å‹
â”œâ”€â”€ æä¾›çº³ç¾å…ƒä»·æ ¼è®¡ç®—å·¥å…·
â”œâ”€â”€ å®šä¹‰å®šä»·é…ç½® Schema
â”œâ”€â”€ æä¾›é€šç”¨é”™è¯¯ç±»å‹
â””â”€â”€ å­˜æ”¾é…ç½®å’Œå¸¸é‡
```

## ğŸ§… ç¬¬äºŒå±‚ï¼šCommon æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          common æ•´ä½“æ¶æ„                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                          æ ¸å¿ƒç±»å‹å±‚                                  â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚    â”‚
â”‚  â”‚  â”‚   Currency   â”‚  â”‚MultiCurrency â”‚  â”‚  ExchangeRate â”‚               â”‚    â”‚
â”‚  â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚    Price     â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚    â”‚
â”‚  â”‚  â”‚ USD          â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚ from_currencyâ”‚               â”‚    â”‚
â”‚  â”‚  â”‚ CNY          â”‚  â”‚ usd: Price   â”‚  â”‚ to_currency  â”‚               â”‚    â”‚
â”‚  â”‚  â”‚ EUR          â”‚  â”‚ cny: Price   â”‚  â”‚ rate (scaled)â”‚               â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚    â”‚
â”‚  â”‚  â”‚    User      â”‚  â”‚    Token     â”‚  â”‚   Channel    â”‚               â”‚    â”‚
â”‚  â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚    â”‚
â”‚  â”‚  â”‚ id           â”‚  â”‚ id           â”‚  â”‚ id           â”‚               â”‚    â”‚
â”‚  â”‚  â”‚ username     â”‚  â”‚ user_id      â”‚  â”‚ type_        â”‚               â”‚    â”‚
â”‚  â”‚  â”‚ balance_usd  â”‚  â”‚ key (sk-xxx) â”‚  â”‚ key          â”‚               â”‚    â”‚
â”‚  â”‚  â”‚ balance_cny  â”‚  â”‚ quota_limit  â”‚  â”‚ base_url     â”‚               â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                          ä»·æ ¼å¤„ç†å±‚                                  â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚    â”‚
â”‚  â”‚  â”‚    price_u64       â”‚    â”‚  pricing_config    â”‚                   â”‚    â”‚
â”‚  â”‚  â”‚                    â”‚    â”‚                    â”‚                   â”‚    â”‚
â”‚  â”‚  â”‚ dollars_to_nano()  â”‚    â”‚ PricingConfig      â”‚                   â”‚    â”‚
â”‚  â”‚  â”‚ nano_to_dollars()  â”‚    â”‚ ModelPricing       â”‚                   â”‚    â”‚
â”‚  â”‚  â”‚ NANO_PER_DOLLAR    â”‚    â”‚ TieredPriceConfig  â”‚                   â”‚    â”‚
â”‚  â”‚  â”‚ RATE_SCALE         â”‚    â”‚ CachePricingConfig â”‚                   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                          å·¥å…·å’Œé…ç½®å±‚                                â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚   error    â”‚  â”‚   config   â”‚  â”‚ constants  â”‚  â”‚   utils    â”‚    â”‚    â”‚
â”‚  â”‚  â”‚            â”‚  â”‚            â”‚  â”‚            â”‚  â”‚            â”‚    â”‚    â”‚
â”‚  â”‚  â”‚ AppError   â”‚  â”‚ AppConfig  â”‚  â”‚ ROLE_*     â”‚  â”‚ hash_pwd() â”‚    â”‚    â”‚
â”‚  â”‚  â”‚            â”‚  â”‚            â”‚  â”‚ PORT       â”‚  â”‚ jwt_*()    â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§… ç¬¬ä¸‰å±‚ï¼šæºç ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            common/src/ ç»“æ„                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  lib.rs (å…¥å£)                                                               â”‚
â”‚  â”‚                                                                           â”‚
â”‚  â”œâ”€â”€ æ¨¡å—å£°æ˜                                                                â”‚
â”‚  â”‚   â”œâ”€â”€ pub mod config          # é…ç½®å¸¸é‡                                 â”‚
â”‚  â”‚   â”œâ”€â”€ pub mod constants       # åº”ç”¨å¸¸é‡                                 â”‚
â”‚  â”‚   â”œâ”€â”€ pub mod error           # é”™è¯¯ç±»å‹                                 â”‚
â”‚  â”‚   â”œâ”€â”€ pub mod price_u64       # çº³ç¾å…ƒä»·æ ¼å¤„ç†                           â”‚
â”‚  â”‚   â”œâ”€â”€ pub mod pricing_config  # å®šä»·é…ç½® Schema                          â”‚
â”‚  â”‚   â”œâ”€â”€ pub mod types           # æ ¸å¿ƒæ•°æ®ç±»å‹                             â”‚
â”‚  â”‚   â””â”€â”€ pub mod utils           # å·¥å…·å‡½æ•°                                 â”‚
â”‚  â”‚                                                                           â”‚
â”‚  â””â”€â”€ ä¾¿æ·å¯¼å‡º                                                                 â”‚
â”‚      â””â”€â”€ pub use *                                                           â”‚
â”‚                                                                              â”‚
â”‚  å„æ¨¡å—æ–‡ä»¶:                                                                 â”‚
â”‚  â”œâ”€â”€ config.rs         # é…ç½®å¸¸é‡ (AppConfig)                               â”‚
â”‚  â”œâ”€â”€ constants.rs      # åº”ç”¨å¸¸é‡ (ROLE_*, PORT, ...)                       â”‚
â”‚  â”œâ”€â”€ error.rs          # é”™è¯¯ç±»å‹ (AppError)                                â”‚
â”‚  â”œâ”€â”€ price_u64.rs      # çº³ç¾å…ƒä»·æ ¼å¤„ç†                                     â”‚
â”‚  â”œâ”€â”€ pricing_config.rs # å®šä»·é…ç½® Schema                                    â”‚
â”‚  â”œâ”€â”€ types.rs          # æ ¸å¿ƒæ•°æ®ç±»å‹                                       â”‚
â”‚  â””â”€â”€ utils.rs          # å·¥å…·å‡½æ•°                                           â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§… ç¬¬å››å±‚ï¼štypes.rs - æ ¸å¿ƒæ•°æ®ç±»å‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              types.rs                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Currency (è´§å¸æšä¸¾)                                                   â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  pub enum Currency {                                                   â”‚  â”‚
â”‚  â”‚      USD,    // ç¾å…ƒ ($)                                               â”‚  â”‚
â”‚  â”‚      CNY,    // äººæ°‘å¸ (Â¥)                                             â”‚  â”‚
â”‚  â”‚      EUR,    // æ¬§å…ƒ (â‚¬)                                               â”‚  â”‚
â”‚  â”‚  }                                                                     â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  impl: Display, FromStr, Serialize, Deserialize                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ChannelType (é€šé“ç±»å‹æšä¸¾) - 50+ æ¸ é“                                 â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  pub enum ChannelType {                                                â”‚  â”‚
â”‚  â”‚      OpenAI = 1,                                                       â”‚  â”‚
â”‚  â”‚      Azure = 3,                                                        â”‚  â”‚
â”‚  â”‚      Anthropic = 14,                                                   â”‚  â”‚
â”‚  â”‚      Gemini = 24,                                                      â”‚  â”‚
â”‚  â”‚      VertexAi = 41,                                                    â”‚  â”‚
â”‚  â”‚      // ... æ›´å¤šæ¸ é“ç±»å‹                                               â”‚  â”‚
â”‚  â”‚  }                                                                     â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  impl: From<i32>, FromStr                                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  User (ç”¨æˆ·) - åŒå¸ç§é’±åŒ…                                              â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  pub struct User {                                                     â”‚  â”‚
â”‚  â”‚      pub id: String,                                                   â”‚  â”‚
â”‚  â”‚      pub username: String,                                             â”‚  â”‚
â”‚  â”‚      pub password: String,           // bcrypt å“ˆå¸Œ                    â”‚  â”‚
â”‚  â”‚      pub role: i32,                  // è§’è‰²: 1/10/100                 â”‚  â”‚
â”‚  â”‚      pub balance_usd: i64,           // USD ä½™é¢ (çº³ç¾å…ƒ)              â”‚  â”‚
â”‚  â”‚      pub balance_cny: i64,           // CNY ä½™é¢ (çº³ç¾å…ƒç­‰å€¼)          â”‚  â”‚
â”‚  â”‚      pub group: String,              // ç”¨æˆ·ç»„                         â”‚  â”‚
â”‚  â”‚      pub created_at: String,         // åˆ›å»ºæ—¶é—´                       â”‚  â”‚
â”‚  â”‚  }                                                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Token (è®¿é—®ä»¤ç‰Œ)                                                      â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  pub struct Token {                                                    â”‚  â”‚
â”‚  â”‚      pub id: String,                                                   â”‚  â”‚
â”‚  â”‚      pub user_id: String,            // æ‰€å±ç”¨æˆ·                       â”‚  â”‚
â”‚  â”‚      pub key: String,                // sk-xxxx æ ¼å¼                   â”‚  â”‚
â”‚  â”‚      pub status: i32,                // 1=æœ‰æ•ˆ, 0=ç¦ç”¨                 â”‚  â”‚
â”‚  â”‚      pub name: String,               // Token åç§°                     â”‚  â”‚
â”‚  â”‚      pub quota_limit: i64,           // é…é¢é™åˆ¶                       â”‚  â”‚
â”‚  â”‚      pub used_quota: i64,            // å·²ä½¿ç”¨é…é¢                     â”‚  â”‚
â”‚  â”‚      pub expired_time: Option<String>,                                  â”‚  â”‚
â”‚  â”‚      pub accessed_time: Option<String>,                                 â”‚  â”‚
â”‚  â”‚  }                                                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Channel (ä¸Šæ¸¸é€šé“)                                                    â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  pub struct Channel {                                                  â”‚  â”‚
â”‚  â”‚      pub id: i32,                                                      â”‚  â”‚
â”‚  â”‚      pub type_: i32,                 // ChannelType                    â”‚  â”‚
â”‚  â”‚      pub key: String,                // API å¯†é’¥                       â”‚  â”‚
â”‚  â”‚      pub base_url: Option<String>,   // ä¸Šæ¸¸åœ°å€                       â”‚  â”‚
â”‚  â”‚      pub models: String,             // é€—å·åˆ†éš”                       â”‚  â”‚
â”‚  â”‚      pub group: String,                                                â”‚  â”‚
â”‚  â”‚      pub name: String,                                                 â”‚  â”‚
â”‚  â”‚      pub priority: i32,              // ä¼˜å…ˆçº§                         â”‚  â”‚
â”‚  â”‚      pub api_version: Option<String>,                                   â”‚  â”‚
â”‚  â”‚      pub param_override: Option<String>,   // JSON                     â”‚  â”‚
â”‚  â”‚      pub header_override: Option<String>,  // JSON                     â”‚  â”‚
â”‚  â”‚  }                                                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Price (æ¨¡å‹ä»·æ ¼) - çº³ç¾å…ƒç²¾åº¦                                         â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  pub struct Price {                                                    â”‚  â”‚
â”‚  â”‚      pub id: Option<i32>,                                              â”‚  â”‚
â”‚  â”‚      pub model: String,              // æ¨¡å‹å                         â”‚  â”‚
â”‚  â”‚      pub currency: String,           // USD/CNY                        â”‚  â”‚
â”‚  â”‚      pub input_price: i64,           // è¾“å…¥ (çº³ç¾å…ƒ/ç™¾ä¸‡Token)        â”‚  â”‚
â”‚  â”‚      pub output_price: i64,          // è¾“å‡º                           â”‚  â”‚
â”‚  â”‚      pub cache_read_input_price: Option<i64>,                          â”‚  â”‚
â”‚  â”‚      pub cache_creation_input_price: Option<i64>,                      â”‚  â”‚
â”‚  â”‚      pub batch_input_price: Option<i64>,                               â”‚  â”‚
â”‚  â”‚      pub batch_output_price: Option<i64>,                              â”‚  â”‚
â”‚  â”‚      pub priority_input_price: Option<i64>,                            â”‚  â”‚
â”‚  â”‚      pub priority_output_price: Option<i64>,                           â”‚  â”‚
â”‚  â”‚      pub audio_input_price: Option<i64>,                               â”‚  â”‚
â”‚  â”‚      pub region: Option<String>,     // cn/international/universal     â”‚  â”‚
â”‚  â”‚  }                                                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  TieredPrice (åˆ†æ®µå®šä»·)                                                â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  pub struct TieredPrice {                                              â”‚  â”‚
â”‚  â”‚      pub id: Option<i32>,                                              â”‚  â”‚
â”‚  â”‚      pub model: String,                                                â”‚  â”‚
â”‚  â”‚      pub region: Option<String>,     // cn/international              â”‚  â”‚
â”‚  â”‚      pub tier_start: i64,            // èµ·å§‹ Token                     â”‚  â”‚
â”‚  â”‚      pub tier_end: i64,              // ç»“æŸ Token                     â”‚  â”‚
â”‚  â”‚      pub input_price: i64,           // è¾“å…¥ä»·æ ¼                       â”‚  â”‚
â”‚  â”‚      pub output_price: i64,          // è¾“å‡ºä»·æ ¼                       â”‚  â”‚
â”‚  â”‚  }                                                                     â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  ç”¨é€”: Qwen ç­‰æ¨¡å‹æŒ‰ä¸Šä¸‹æ–‡é•¿åº¦åˆ†æ®µè®¡è´¹                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§… ç¬¬äº”å±‚ï¼šprice_u64.rs - çº³ç¾å…ƒä»·æ ¼å¤„ç†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            price_u64.rs                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  å¸¸é‡å®šä¹‰                                                              â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  pub const NANO_PER_DOLLAR: i64 = 1_000_000_000;                       â”‚  â”‚
â”‚  â”‚  // 1 ç¾å…ƒ = 10 äº¿çº³ç¾å…ƒ                                               â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  pub const RATE_SCALE: i64 = 1_000_000_000;                            â”‚  â”‚
â”‚  â”‚  // æ±‡ç‡ç¼©æ”¾å› å­ (9 ä½å°æ•°ç²¾åº¦)                                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  è½¬æ¢å‡½æ•°                                                              â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  dollars_to_nano(dollars: f64) -> i64                                  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  è¾“å…¥              è¾“å‡º                                         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  $0.002       â†’    2_000_000 (çº³ç¾å…ƒ)                           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  $1.50        â†’    1_500_000_000                                 â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  $0.000001    â†’    1_000 (æœ€å°ç²¾åº¦)                             â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  nano_to_dollars(nano: i64) -> f64                                     â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  è¾“å…¥              è¾“å‡º                                         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  2_000_000    â†’    $0.002                                       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  1_500_000_000 â†’   $1.50                                        â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  rate_to_scaled(rate: f64) -> i64                                      â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  7.2 (USD/CNY æ±‡ç‡) â†’ 7_200_000_000                              â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  scaled_to_rate(scaled: i64) -> f64                                    â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  7_200_000_000 â†’ 7.2                                            â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  è®¡è´¹è®¡ç®—                                                              â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  calculate_cost_safe(price_per_million: i64, tokens: u64) -> f64       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  å‚æ•°:                                                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - price_per_million: çº³ç¾å…ƒ/ç™¾ä¸‡Token                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - tokens: ä½¿ç”¨çš„ Token æ•°                                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  è¿”å›: ç¾å…ƒæˆæœ¬                                                 â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  å…¬å¼: cost = price Ã— tokens / 1_000_000 / NANO_PER_DOLLAR     â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ä¸ºä»€ä¹ˆç”¨çº³ç¾å…ƒ (i64)?                                                 â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  âœ“ é¿å… f64 ç²¾åº¦ä¸¢å¤±                                                   â”‚  â”‚
â”‚  â”‚  âœ“ æ”¯æŒç²¾ç¡®çš„è´¢åŠ¡è®¡ç®—                                                  â”‚  â”‚
â”‚  â”‚  âœ“ ä»·æ ¼èŒƒå›´: $0.000001 ~ $9.2B                                        â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  ç¤ºä¾‹: GPT-4 å®šä»·                                                       â”‚  â”‚
â”‚  â”‚  â€¢ è¾“å…¥: $30/ç™¾ä¸‡Token  â†’ 30_000_000_000 çº³ç¾å…ƒ                       â”‚  â”‚
â”‚  â”‚  â€¢ è¾“å‡º: $60/ç™¾ä¸‡Token  â†’ 60_000_000_000 çº³ç¾å…ƒ                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§… ç¬¬å…­å±‚ï¼špricing_config.rs - å®šä»·é…ç½® Schema

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         pricing_config.rs                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  PricingConfig (æ ¹ç»“æ„)                                                â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  pub struct PricingConfig {                                            â”‚  â”‚
â”‚  â”‚      pub version: String,            // "1.0"                          â”‚  â”‚
â”‚  â”‚      pub source: String,             // æ¥æºæ ‡è¯†                       â”‚  â”‚
â”‚  â”‚      pub models: HashMap<String, ModelPricing>,                       â”‚  â”‚
â”‚  â”‚  }                                                                     â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  ç”¨é€”: ä» pricing.json æ–‡ä»¶åŠ è½½æ¨¡å‹å®šä»·é…ç½®                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ModelPricing (æ¨¡å‹å®šä»·)                                               â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  pub struct ModelPricing {                                             â”‚  â”‚
â”‚  â”‚      pub usd: Option<CurrencyPricing>,   // ç¾å…ƒå®šä»·                   â”‚  â”‚
â”‚  â”‚      pub cny: Option<CurrencyPricing>,   // äººæ°‘å¸å®šä»·                 â”‚  â”‚
â”‚  â”‚      pub tiered: Option<Vec<TieredPriceConfig>>, // åˆ†æ®µå®šä»·          â”‚  â”‚
â”‚  â”‚      pub cache: Option<CachePricingConfig>,        // ç¼“å­˜å®šä»·        â”‚  â”‚
â”‚  â”‚      pub batch_discount: Option<f64>,              // æ‰¹é‡æŠ˜æ‰£        â”‚  â”‚
â”‚  â”‚      pub priority_multiplier: Option<f64>,         // ä¼˜å…ˆçº§å€æ•°      â”‚  â”‚
â”‚  â”‚  }                                                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  CurrencyPricing (è´§å¸å®šä»·)                                            â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  pub struct CurrencyPricing {                                          â”‚  â”‚
â”‚  â”‚      pub input_price: f64,       // æ¯ç™¾ä¸‡ Token è¾“å…¥ä»·æ ¼             â”‚  â”‚
â”‚  â”‚      pub output_price: f64,      // æ¯ç™¾ä¸‡ Token è¾“å‡ºä»·æ ¼             â”‚  â”‚
â”‚  â”‚      pub region: Option<String>, // cn/international/universal        â”‚  â”‚
â”‚  â”‚  }                                                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  TieredPriceConfig (åˆ†æ®µå®šä»·é…ç½®)                                      â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  pub struct TieredPriceConfig {                                        â”‚  â”‚
â”‚  â”‚      pub tier_start: i64,        // èµ·å§‹ Token æ•°                      â”‚  â”‚
â”‚  â”‚      pub tier_end: i64,          // ç»“æŸ Token æ•°                      â”‚  â”‚
â”‚  â”‚      pub input_price: f64,                                             â”‚  â”‚
â”‚  â”‚      pub output_price: f64,                                            â”‚  â”‚
â”‚  â”‚  }                                                                     â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  ç¤ºä¾‹ (Qwen åˆ†æ®µå®šä»·):                                                 â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  Token èŒƒå›´          è¾“å…¥ä»·æ ¼      è¾“å‡ºä»·æ ¼                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  0 - 128K            $0.50/ç™¾ä¸‡    $2.00/ç™¾ä¸‡                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  128K - 1M           $1.00/ç™¾ä¸‡    $4.00/ç™¾ä¸‡                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  1M+                 $2.00/ç™¾ä¸‡    $8.00/ç™¾ä¸‡                   â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  CachePricingConfig (ç¼“å­˜å®šä»·é…ç½®)                                     â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  pub struct CachePricingConfig {                                       â”‚  â”‚
â”‚  â”‚      pub cache_read_discount: f64,     // ç¼“å­˜è¯»å–æŠ˜æ‰£ (é»˜è®¤ 0.1)     â”‚  â”‚
â”‚  â”‚      pub cache_creation_discount: f64, // ç¼“å­˜åˆ›å»ºæŠ˜æ‰£ (é»˜è®¤ 0.25)    â”‚  â”‚
â”‚  â”‚  }                                                                     â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  Prompt Caching ç¤ºä¾‹:                                                  â”‚  â”‚
â”‚  â”‚  â€¢ æ ‡å‡†ä»·æ ¼: $10/ç™¾ä¸‡ Token                                           â”‚  â”‚
â”‚  â”‚  â€¢ ç¼“å­˜è¯»å–: $1/ç™¾ä¸‡ Token (10%)                                      â”‚  â”‚
â”‚  â”‚  â€¢ ç¼“å­˜åˆ›å»º: $2.5/ç™¾ä¸‡ Token (25%)                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  éªŒè¯æœºåˆ¶                                                              â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  pub struct ValidationError { ... }   // é”™è¯¯                          â”‚  â”‚
â”‚  â”‚  pub struct ValidationWarning { ... } // è­¦å‘Š                          â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  impl PricingConfig {                                                  â”‚  â”‚
â”‚  â”‚      pub fn validate(&self) -> Result<Vec<ValidationWarning>>         â”‚  â”‚
â”‚  â”‚      // éªŒè¯é…ç½®çš„æœ‰æ•ˆæ€§å’Œå®Œæ•´æ€§                                       â”‚  â”‚
â”‚  â”‚  }                                                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§… ç¬¬ä¸ƒå±‚ï¼šå·¥å…·æ¨¡å—

### error.rs - é”™è¯¯ç±»å‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                             error.rs                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  pub enum AppError {                                                         â”‚
â”‚      DatabaseError(String),       // æ•°æ®åº“é”™è¯¯                             â”‚
â”‚      AuthenticationError(String), // è®¤è¯é”™è¯¯                               â”‚
â”‚      NotFoundError(String),       // æœªæ‰¾åˆ°                                 â”‚
â”‚      ValidationError(String),     // éªŒè¯é”™è¯¯                               â”‚
â”‚      InternalError(String),       // å†…éƒ¨é”™è¯¯                               â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  impl: Display, Error, IntoResponse (ç”¨äº axum)                              â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### constants.rs - åº”ç”¨å¸¸é‡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           constants.rs                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  // è·¯ç”±å¸¸é‡                                                                 â”‚
â”‚  pub const INTERNAL_PREFIX: &str = "/_internal";                             â”‚
â”‚                                                                              â”‚
â”‚  // ç”¨æˆ·è§’è‰²                                                                 â”‚
â”‚  pub const ROLE_COMMON: i32 = 1;      // æ™®é€šç”¨æˆ·                           â”‚
â”‚  pub const ROLE_ADMIN: i32 = 10;      // ç®¡ç†å‘˜                             â”‚
â”‚  pub const ROLE_ROOT: i32 = 100;      // è¶…çº§ç®¡ç†å‘˜                         â”‚
â”‚                                                                              â”‚
â”‚  // é»˜è®¤é…ç½®                                                                 â”‚
â”‚  pub const DEFAULT_PORT: u16 = 3000;                                         â”‚
â”‚  pub const DEFAULT_HOST: &str = "127.0.0.1";                                 â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### utils.rs - å·¥å…·å‡½æ•°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                             utils.rs                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  // å¯†ç å¤„ç†                                                                 â”‚
â”‚  pub fn hash_password(password: &str) -> Result<String>                      â”‚
â”‚  pub fn verify_password(password: &str, hash: &str) -> bool                  â”‚
â”‚                                                                              â”‚
â”‚  // Token ç”Ÿæˆ                                                               â”‚
â”‚  pub fn generate_token() -> String    // ç”Ÿæˆ sk- å‰ç¼€çš„éšæœº Token           â”‚
â”‚                                                                              â”‚
â”‚  // JWT å¤„ç†                                                                 â”‚
â”‚  pub fn create_jwt(claims: &Claims) -> Result<String>                        â”‚
â”‚  pub fn verify_jwt(token: &str) -> Result<Claims>                            â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§… ç¬¬å…«å±‚ï¼šæ–‡ä»¶çº§è¯¦è§£

### lib.rs - æ¨¡å—å…¥å£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                               lib.rs                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  æ¨¡å—å£°æ˜:                                                                   â”‚
â”‚  pub mod config;                                                             â”‚
â”‚  pub mod constants;                                                          â”‚
â”‚  pub mod error;                                                              â”‚
â”‚  pub mod price_u64;                                                          â”‚
â”‚  pub mod pricing_config;                                                     â”‚
â”‚  pub mod types;                                                              â”‚
â”‚  pub mod utils;                                                              â”‚
â”‚                                                                              â”‚
â”‚  ä¾¿æ·é‡å¯¼å‡º:                                                                 â”‚
â”‚  pub use types::{Currency, User, Token, Channel, Price, ...};               â”‚
â”‚  pub use price_u64::{dollars_to_nano, nano_to_dollars, ...};                â”‚
â”‚  pub use error::AppError;                                                    â”‚
â”‚                                                                              â”‚
â”‚  crate ç‰¹ç‚¹:                                                                 â”‚
â”‚  â€¢ æ— å¤–éƒ¨ crate ä¾èµ– (ä»… serde/thiserror)                                   â”‚
â”‚  â€¢ æ‰€æœ‰ç±»å‹å®ç° Serialize/Deserialize                                       â”‚
â”‚  â€¢ çº¯æ•°æ®ç»“æ„ï¼Œæ— ä¸šåŠ¡é€»è¾‘                                                   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### config.rs - é…ç½®å¸¸é‡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              config.rs                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  pub struct AppConfig {                                                      â”‚
â”‚      pub database_url: String,           // æ•°æ®åº“ URL                      â”‚
â”‚      pub server_port: u16,               // æœåŠ¡å™¨ç«¯å£                      â”‚
â”‚      pub server_host: String,            // æœåŠ¡å™¨åœ°å€                      â”‚
â”‚      pub jwt_secret: String,             // JWT å¯†é’¥                        â”‚
â”‚      pub log_level: String,              // æ—¥å¿—çº§åˆ«                        â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  impl AppConfig {                                                            â”‚
â”‚      pub fn from_env() -> Result<Self>                                       â”‚
â”‚      // ä»ç¯å¢ƒå˜é‡åŠ è½½é…ç½®                                                  â”‚
â”‚                                                                              â”‚
â”‚      pub fn database_path(&self) -> PathBuf                                 â”‚
â”‚      // è§£ææ•°æ®åº“è·¯å¾„                                                      â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  ç¯å¢ƒå˜é‡:                                                                   â”‚
â”‚  DATABASE_URL      â†’ database_url                                           â”‚
â”‚  PORT              â†’ server_port (é»˜è®¤ 3000)                                â”‚
â”‚  HOST              â†’ server_host (é»˜è®¤ 127.0.0.1)                           â”‚
â”‚  JWT_SECRET        â†’ jwt_secret                                             â”‚
â”‚  RUST_LOG          â†’ log_level                                              â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### constants.rs - åº”ç”¨å¸¸é‡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            constants.rs                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  // è·¯ç”±å¸¸é‡                                                                 â”‚
â”‚  pub const INTERNAL_PREFIX: &str = "/_internal";                             â”‚
â”‚  pub const API_PREFIX: &str = "/api";                                        â”‚
â”‚  pub const V1_PREFIX: &str = "/v1";                                          â”‚
â”‚                                                                              â”‚
â”‚  // ç”¨æˆ·è§’è‰²                                                                 â”‚
â”‚  pub const ROLE_COMMON: i32 = 1;          // æ™®é€šç”¨æˆ·                       â”‚
â”‚  pub const ROLE_ADMIN: i32 = 10;          // ç®¡ç†å‘˜                         â”‚
â”‚  pub const ROLE_ROOT: i32 = 100;          // è¶…çº§ç®¡ç†å‘˜                     â”‚
â”‚                                                                              â”‚
â”‚  // é»˜è®¤é…ç½®                                                                 â”‚
â”‚  pub const DEFAULT_PORT: u16 = 3000;                                         â”‚
â”‚  pub const DEFAULT_HOST: &str = "127.0.0.1";                                 â”‚
â”‚  pub const DEFAULT_DATABASE_NAME: &str = "burncloud.db";                     â”‚
â”‚  pub const DEFAULT_DATABASE_DIR: &str = ".burncloud";                        â”‚
â”‚                                                                              â”‚
â”‚  // ä»·æ ¼å¸¸é‡                                                                 â”‚
â”‚  pub const TOKENS_PER_MILLION: i64 = 1_000_000;                              â”‚
â”‚  pub const CACHE_READ_DISCOUNT: f64 = 0.10;    // 10% æ ‡å‡†ä»·æ ¼              â”‚
â”‚  pub const CACHE_CREATION_DISCOUNT: f64 = 0.25; // 25% æ ‡å‡†ä»·æ ¼             â”‚
â”‚  pub const BATCH_DISCOUNT: f64 = 0.50;         // 50% æ ‡å‡†ä»·æ ¼              â”‚
â”‚  pub const PRIORITY_MULTIPLIER: f64 = 1.70;    // 170% æ ‡å‡†ä»·æ ¼             â”‚
â”‚                                                                              â”‚
â”‚  // é™æµå¸¸é‡                                                                 â”‚
â”‚  pub const DEFAULT_RATE_LIMIT: u32 = 100;   // æ¯åˆ†é’Ÿè¯·æ±‚æ•°                 â”‚
â”‚  pub const DEFAULT_BURST_SIZE: u32 = 20;    // çªå‘å¤§å°                     â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### error.rs - é”™è¯¯ç±»å‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              error.rs                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  #[derive(Debug, thiserror::Error)]                                          â”‚
â”‚  pub enum AppError {                                                         â”‚
â”‚      #[error("Database error: {0}")]                                         â”‚
â”‚      DatabaseError(String),                                                  â”‚
â”‚                                                                              â”‚
â”‚      #[error("Authentication failed: {0}")]                                  â”‚
â”‚      AuthenticationError(String),                                            â”‚
â”‚                                                                              â”‚
â”‚      #[error("Resource not found: {0}")]                                     â”‚
â”‚      NotFoundError(String),                                                  â”‚
â”‚                                                                              â”‚
â”‚      #[error("Validation error: {0}")]                                       â”‚
â”‚      ValidationError(String),                                                â”‚
â”‚                                                                              â”‚
â”‚      #[error("Unauthorized access")]                                         â”‚
â”‚      UnauthorizedError,                                                      â”‚
â”‚                                                                              â”‚
â”‚      #[error("Internal server error: {0}")]                                  â”‚
â”‚      InternalError(String),                                                  â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  impl From<sqlx::Error> for AppError { ... }                                 â”‚
â”‚  impl From<serde_json::Error> for AppError { ... }                          â”‚
â”‚                                                                              â”‚
â”‚  // ç”¨äº axum å“åº”                                                           â”‚
â”‚  impl IntoResponse for AppError {                                            â”‚
â”‚      fn into_response(self) -> Response {                                    â”‚
â”‚          let (status, message) = match self {                                â”‚
â”‚              AppError::DatabaseError(msg) => (500, msg),                    â”‚
â”‚              AppError::AuthenticationError(msg) => (401, msg),              â”‚
â”‚              AppError::NotFoundError(msg) => (404, msg),                    â”‚
â”‚              AppError::ValidationError(msg) => (400, msg),                  â”‚
â”‚              AppError::UnauthorizedError => (401, "Unauthorized"),          â”‚
â”‚              AppError::InternalError(msg) => (500, msg),                    â”‚
â”‚          };                                                                  â”‚
â”‚          (status, Json(json!({ "error": message }))).into_response()        â”‚
â”‚      }                                                                       â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### utils.rs - å·¥å…·å‡½æ•°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              utils.rs                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  // å¯†ç å¤„ç†                                                                 â”‚
â”‚  pub fn hash_password(password: &str) -> Result<String>                      â”‚
â”‚  // ä½¿ç”¨ bcrypt å“ˆå¸Œå¯†ç                                                     â”‚
â”‚                                                                              â”‚
â”‚  pub fn verify_password(password: &str, hash: &str) -> bool                  â”‚
â”‚  // éªŒè¯å¯†ç æ˜¯å¦åŒ¹é…                                                        â”‚
â”‚                                                                              â”‚
â”‚  // Token ç”Ÿæˆ                                                               â”‚
â”‚  pub fn generate_token() -> String                                           â”‚
â”‚  // ç”Ÿæˆ sk- å‰ç¼€çš„éšæœº Token                                               â”‚
â”‚  // æ ¼å¼: sk-{32ä½éšæœºå­—ç¬¦}                                                 â”‚
â”‚                                                                              â”‚
â”‚  pub fn generate_uuid() -> String                                            â”‚
â”‚  // ç”Ÿæˆ UUID v4                                                            â”‚
â”‚                                                                              â”‚
â”‚  // JWT å¤„ç†                                                                 â”‚
â”‚  pub fn create_jwt(claims: &Claims, secret: &str) -> Result<String>         â”‚
â”‚  // åˆ›å»º JWT Token                                                          â”‚
â”‚                                                                              â”‚
â”‚  pub fn verify_jwt(token: &str, secret: &str) -> Result<Claims>             â”‚
â”‚  // éªŒè¯ JWT Token å¹¶è¿”å› Claims                                            â”‚
â”‚                                                                              â”‚
â”‚  // å…¶ä»–å·¥å…·                                                                 â”‚
â”‚  pub fn format_timestamp(dt: DateTime<Utc>) -> String                        â”‚
â”‚  // æ ¼å¼åŒ–æ—¶é—´æˆ³ä¸º ISO 8601                                                 â”‚
â”‚                                                                              â”‚
â”‚  pub fn parse_timestamp(s: &str) -> Result<DateTime<Utc>>                    â”‚
â”‚  // è§£æ ISO 8601 æ—¶é—´æˆ³                                                    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§… ç¬¬ä¹å±‚ï¼šä½¿ç”¨ç¤ºä¾‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              ä½¿ç”¨ç¤ºä¾‹                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  use burncloud_common::{                                                    â”‚
â”‚      Currency,                                                              â”‚
â”‚      types::{User, Token, Channel, Price},                                  â”‚
â”‚      price_u64::{dollars_to_nano, nano_to_dollars},                         â”‚
â”‚  };                                                                         â”‚
â”‚                                                                              â”‚
â”‚  // ä»·æ ¼è½¬æ¢                                                                â”‚
â”‚  let price = dollars_to_nano(0.002);  // $0.002 â†’ 2_000_000 çº³ç¾å…ƒ         â”‚
â”‚  let display = nano_to_dollars(price); // â†’ 0.002                          â”‚
â”‚                                                                              â”‚
â”‚  // åˆ›å»ºç”¨æˆ· (åŒå¸ç§é’±åŒ…)                                                   â”‚
â”‚  let user = User {                                                          â”‚
â”‚      id: "uuid".to_string(),                                                â”‚
â”‚      username: "test".to_string(),                                          â”‚
â”‚      balance_usd: dollars_to_nano(100.0),   // $100 USD                    â”‚
â”‚      balance_cny: dollars_to_nano(700.0),   // Â¥700 CNY (ç­‰å€¼)             â”‚
â”‚      ..Default::default()                                                   â”‚
â”‚  };                                                                         â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§… ä¾èµ–å…³ç³»

```
burncloud-common (åŸºç¡€å±‚ï¼Œæ— å†…éƒ¨ä¾èµ–)

è¢«ä»¥ä¸‹ crate ä¾èµ–:
â”œâ”€â”€ burncloud-router
â”œâ”€â”€ burncloud-server
â”œâ”€â”€ burncloud-database
â”œâ”€â”€ burncloud-client
â”œâ”€â”€ burncloud-cli
â””â”€â”€ ...

å¤–éƒ¨ä¾èµ–:
â”œâ”€â”€ serde           # åºåˆ—åŒ–
â”œâ”€â”€ serde_json      # JSON å¤„ç†
â””â”€â”€ thiserror       # é”™è¯¯å®šä¹‰
```
