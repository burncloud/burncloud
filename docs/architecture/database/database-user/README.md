# database-user

ç”¨æˆ·æ•°æ®è®¿é—®å±‚ï¼Œå¤„ç†ç”¨æˆ·å’Œ Token çš„ CRUD æ“ä½œã€‚

## ğŸ§… ç¬¬ä¸€å±‚ï¼šåœ¨ Database ä¸­çš„ä½ç½®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          burncloud-database                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚                        æ•°æ®åº“å±‚                                     â”‚    â”‚
â”‚   â”‚                                                                     â”‚    â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚   â”‚   â”‚database-router â”‚  â”‚â˜…database-user  â”‚  â”‚ database-models    â”‚   â”‚    â”‚
â”‚   â”‚   â”‚                â”‚  â”‚                â”‚  â”‚                    â”‚   â”‚    â”‚
â”‚   â”‚   â”‚ Token éªŒè¯     â”‚  â”‚ ç”¨æˆ· CRUD      â”‚  â”‚ ä»·æ ¼ç®¡ç†           â”‚   â”‚    â”‚
â”‚   â”‚   â”‚ é…é¢ç®¡ç†       â”‚  â”‚ Token ç®¡ç†     â”‚  â”‚ æ¨¡å‹é…ç½®           â”‚   â”‚    â”‚
â”‚   â”‚   â”‚ æ—¥å¿—å­˜å‚¨       â”‚  â”‚ ä½™é¢æ“ä½œ       â”‚  â”‚                    â”‚   â”‚    â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚   â”‚                                                                     â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

database-user çš„èŒè´£:
â”œâ”€â”€ ç”¨æˆ· CRUD æ“ä½œ
â”œâ”€â”€ ç”¨æˆ·ä½™é¢ç®¡ç† (åŒå¸ç§)
â”œâ”€â”€ Token CRUD æ“ä½œ
â”œâ”€â”€ å……å€¼è®°å½•ç®¡ç†
â””â”€â”€ ç”¨æˆ·è®¤è¯æŸ¥è¯¢
```

## ğŸ§… ç¬¬äºŒå±‚ï¼šæ–‡ä»¶ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       database-user æ–‡ä»¶ç»“æ„                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  crates/database/crates/database-user/                                       â”‚
â”‚  â”‚                                                                           â”‚
â”‚  â”œâ”€â”€ Cargo.toml           # ä¾èµ–é…ç½®                                        â”‚
â”‚  â”œâ”€â”€ src/                                                                    â”‚
â”‚  â”‚   â””â”€â”€ lib.rs           # æ‰€æœ‰æ•°æ®è®¿é—®å‡½æ•°                                â”‚
â”‚  â”‚                                                                           â”‚
â”‚  â””â”€â”€ examples/                                                               â”‚
â”‚      â””â”€â”€ usage.rs         # ä½¿ç”¨ç¤ºä¾‹                                        â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§… ç¬¬ä¸‰å±‚ï¼šlib.rs è¯¦è§£ - ç”¨æˆ·æ“ä½œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”¨æˆ· CRUD æ“ä½œ                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  æ“ä½œçš„æ•°æ®è¡¨: users                                                         â”‚
â”‚                                                                              â”‚
â”‚  è¡¨ç»“æ„:                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  users è¡¨                                                           â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  id            TEXT PRIMARY KEY      ç”¨æˆ·å”¯ä¸€ ID                     â”‚   â”‚
â”‚  â”‚  username      TEXT UNIQUE           ç”¨æˆ·å (å”¯ä¸€)                   â”‚   â”‚
â”‚  â”‚  password      TEXT                  å¯†ç å“ˆå¸Œ (bcrypt)               â”‚   â”‚
â”‚  â”‚  role          INTEGER               è§’è‰² (1/10/100)                 â”‚   â”‚
â”‚  â”‚  balance_usd   INTEGER               USD ä½™é¢ (çº³ç¾å…ƒ)               â”‚   â”‚
â”‚  â”‚  balance_cny   INTEGER               CNY ä½™é¢ (çº³ç¾å…ƒç­‰å€¼)           â”‚   â”‚
â”‚  â”‚  group_name    TEXT                  ç”¨æˆ·ç»„                         â”‚   â”‚
â”‚  â”‚  created_at    TEXT                  åˆ›å»ºæ—¶é—´                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  /// åˆ›å»ºç”¨æˆ·                                                                â”‚
â”‚  pub async fn create_user(db: &Database, input: CreateUserInput)            â”‚
â”‚      -> Result<User>                                                         â”‚
â”‚                                                                              â”‚
â”‚  è¾“å…¥ç»“æ„:                                                                   â”‚
â”‚  pub struct CreateUserInput {                                                â”‚
â”‚      pub username: String,                                                   â”‚
â”‚      pub password: String,           // æ˜æ–‡å¯†ç ï¼Œä¼šè‡ªåŠ¨å“ˆå¸Œ                â”‚
â”‚      pub role: Option<i32>,          // é»˜è®¤ 1                              â”‚
â”‚      pub group: Option<String>,      // é»˜è®¤ "default"                      â”‚
â”‚      pub balance_usd: Option<i64>,   // é»˜è®¤ 0                              â”‚
â”‚      pub balance_cny: Option<i64>,   // é»˜è®¤ 0                              â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  /// è·å–ç”¨æˆ·                                                                â”‚
â”‚  pub async fn get_user(db: &Database, id: &str) -> Result<Option<User>>     â”‚
â”‚                                                                              â”‚
â”‚  /// æŒ‰ç”¨æˆ·åè·å–                                                            â”‚
â”‚  pub async fn get_user_by_username(db: &Database, username: &str)           â”‚
â”‚      -> Result<Option<User>>                                                 â”‚
â”‚                                                                              â”‚
â”‚  /// åˆ—å‡ºç”¨æˆ·                                                                â”‚
â”‚  pub async fn list_users(db: &Database, filter: UserFilter)                 â”‚
â”‚      -> Result<Vec<User>>                                                    â”‚
â”‚                                                                              â”‚
â”‚  /// æ›´æ–°ç”¨æˆ·                                                                â”‚
â”‚  pub async fn update_user(db: &Database, id: &str, input: UpdateUserInput)  â”‚
â”‚      -> Result<User>                                                         â”‚
â”‚                                                                              â”‚
â”‚  /// åˆ é™¤ç”¨æˆ·                                                                â”‚
â”‚  pub async fn delete_user(db: &Database, id: &str) -> Result<()>            â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§… ç¬¬å››å±‚ï¼šä½™é¢æ“ä½œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ä½™é¢æ“ä½œ (åŒå¸ç§)                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  ä»€ä¹ˆæ˜¯åŒå¸ç§?                                                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                            â”‚
â”‚  æ¯ä¸ªç”¨æˆ·æœ‰ä¸¤ä¸ªä½™é¢:                                                          â”‚
â”‚  â€¢ balance_usd: ç¾å…ƒä½™é¢                                                     â”‚
â”‚  â€¢ balance_cny: äººæ°‘å¸ä½™é¢                                                   â”‚
â”‚                                                                              â”‚
â”‚  ä¸¤è€…éƒ½æ˜¯çº³ç¾å…ƒå•ä½ (i64)ï¼Œæ–¹ä¾¿ç»Ÿä¸€è®¡ç®—                                       â”‚
â”‚                                                                              â”‚
â”‚  /// è·å–ä½™é¢                                                                 â”‚
â”‚  pub async fn get_balance(db: &Database, user_id: &str)                     â”‚
â”‚      -> Result<(i64, i64)>           // (usd, cny)                          â”‚
â”‚                                                                              â”‚
â”‚  /// æ›´æ–°ä½™é¢                                                                 â”‚
â”‚  pub async fn update_balance(                                                â”‚
â”‚      db: &Database,                                                          â”‚
â”‚      user_id: &str,                                                          â”‚
â”‚      usd_delta: i64,                 // USD å˜åŒ–é‡ (å¯æ­£å¯è´Ÿ)              â”‚
â”‚      cny_delta: i64,                 // CNY å˜åŒ–é‡ (å¯æ­£å¯è´Ÿ)              â”‚
â”‚  ) -> Result<()>                                                             â”‚
â”‚                                                                              â”‚
â”‚  å®ç°é€»è¾‘:                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  UPDATE users SET                                                   â”‚   â”‚
â”‚  â”‚    balance_usd = balance_usd + ?,                                   â”‚   â”‚
â”‚  â”‚    balance_cny = balance_cny + ?                                    â”‚   â”‚
â”‚  â”‚  WHERE id = ?;                                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  ä½¿ç”¨åœºæ™¯:                                                                   â”‚
â”‚  â”œâ”€â”€ å……å€¼: usd_delta > 0 æˆ– cny_delta > 0                                  â”‚
â”‚  â”œâ”€â”€ æ¶ˆè´¹: usd_delta < 0 (æ ¹æ®ç”¨æˆ·é€‰æ‹©çš„è´§å¸)                               â”‚
â”‚  â””â”€â”€ é€€æ¬¾: usd_delta > 0                                                    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§… ç¬¬äº”å±‚ï¼šToken æ“ä½œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Token æ“ä½œ                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  æ“ä½œçš„æ•°æ®è¡¨: tokens                                                        â”‚
â”‚                                                                              â”‚
â”‚  è¡¨ç»“æ„:                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  tokens è¡¨                                                           â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  id            TEXT PRIMARY KEY      Token å”¯ä¸€ ID                    â”‚   â”‚
â”‚  â”‚  user_id       TEXT                  æ‰€å±ç”¨æˆ·                        â”‚   â”‚
â”‚  â”‚  key           TEXT UNIQUE           sk-xxx æ ¼å¼                     â”‚   â”‚
â”‚  â”‚  name          TEXT                  Token åç§°                      â”‚   â”‚
â”‚  â”‚  status        INTEGER               1=æœ‰æ•ˆ, 0=ç¦ç”¨                   â”‚   â”‚
â”‚  â”‚  quota_limit   INTEGER               é…é¢é™åˆ¶ (çº³ç¾å…ƒ)               â”‚   â”‚
â”‚  â”‚  used_quota    INTEGER               å·²ä½¿ç”¨ (çº³ç¾å…ƒ)                  â”‚   â”‚
â”‚  â”‚  expired_time  TEXT                  è¿‡æœŸæ—¶é—´                        â”‚   â”‚
â”‚  â”‚  accessed_time TEXT                  æœ€åè®¿é—®æ—¶é—´                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  /// åˆ›å»º Token                                                              â”‚
â”‚  pub async fn create_token(db: &Database, input: CreateTokenInput)          â”‚
â”‚      -> Result<Token>                                                        â”‚
â”‚                                                                              â”‚
â”‚  è¾“å…¥ç»“æ„:                                                                   â”‚
â”‚  pub struct CreateTokenInput {                                               â”‚
â”‚      pub user_id: String,                                                    â”‚
â”‚      pub name: String,                                                       â”‚
â”‚      pub quota_limit: Option<i64>,    // é»˜è®¤æ— é™                           â”‚
â”‚      pub expired_time: Option<String>, // é»˜è®¤æ°¸ä¸è¿‡æœŸ                       â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  ç”Ÿæˆé€»è¾‘:                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  1. ç”Ÿæˆ UUID ä½œä¸º id                                               â”‚   â”‚
â”‚  â”‚  2. ç”Ÿæˆéšæœºå­—ç¬¦ä¸²: sk-{32ä½éšæœºå­—ç¬¦}                               â”‚   â”‚
â”‚  â”‚  3. æ’å…¥æ•°æ®åº“                                                      â”‚   â”‚
â”‚  â”‚  4. è¿”å›å®Œæ•´ Token ä¿¡æ¯                                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  /// åˆ—å‡º Token                                                              â”‚
â”‚  pub async fn list_tokens(db: &Database, user_id: Option<&str>)             â”‚
â”‚      -> Result<Vec<Token>>                                                   â”‚
â”‚                                                                              â”‚
â”‚  /// åˆ é™¤ Token                                                              â”‚
â”‚  pub async fn delete_token(db: &Database, id: &str) -> Result<()>           â”‚
â”‚                                                                              â”‚
â”‚  /// æ›´æ–°è®¿é—®æ—¶é—´                                                            â”‚
â”‚  pub async fn update_token_accessed_time(db: &Database, token: &str)        â”‚
â”‚      -> Result<()>                                                           â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§… ç¬¬å…­å±‚ï¼šå……å€¼è®°å½•

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å……å€¼è®°å½•                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  æ“ä½œçš„æ•°æ®è¡¨: recharges                                                     â”‚
â”‚                                                                              â”‚
â”‚  è¡¨ç»“æ„:                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  recharges è¡¨                                                        â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  id           INTEGER PRIMARY KEY   è®°å½• ID                          â”‚   â”‚
â”‚  â”‚  user_id      TEXT                  ç”¨æˆ· ID                         â”‚   â”‚
â”‚  â”‚  amount       INTEGER               å……å€¼é‡‘é¢ (çº³ç¾å…ƒ)                â”‚   â”‚
â”‚  â”‚  currency     TEXT                  è´§å¸ (USD/CNY)                   â”‚   â”‚
â”‚  â”‚  description  TEXT                  å……å€¼æè¿°                         â”‚   â”‚
â”‚  â”‚  created_at   TEXT                  å……å€¼æ—¶é—´                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  /// æ·»åŠ å……å€¼è®°å½•                                                            â”‚
â”‚  pub async fn add_recharge(                                                  â”‚
â”‚      db: &Database,                                                          â”‚
â”‚      user_id: &str,                                                          â”‚
â”‚      amount: i64,                                                            â”‚
â”‚      currency: &str,                  // "USD" æˆ– "CNY"                     â”‚
â”‚      description: &str,               // å……å€¼æè¿°                           â”‚
â”‚  ) -> Result<()>                                                             â”‚
â”‚                                                                              â”‚
â”‚  /// æŸ¥è¯¢å……å€¼è®°å½•                                                            â”‚
â”‚  pub async fn list_recharges(db: &Database, user_id: &str)                  â”‚
â”‚      -> Result<Vec<Recharge>>                                                â”‚
â”‚                                                                              â”‚
â”‚  æµç¨‹:                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  å……å€¼æ“ä½œ:                                                           â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  1. BEGIN TRANSACTION                                               â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  2. æ›´æ–°ç”¨æˆ·ä½™é¢                                                     â”‚   â”‚
â”‚  â”‚     UPDATE users SET balance_usd = balance_usd + ?                  â”‚   â”‚
â”‚  â”‚     WHERE id = ?;                                                    â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  3. æ·»åŠ å……å€¼è®°å½•                                                     â”‚   â”‚
â”‚  â”‚     INSERT INTO recharges (user_id, amount, ...)                    â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  4. COMMIT                                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§… ä¾èµ–å…³ç³»

```
database-user
â”œâ”€â”€ burncloud-database
â”‚   â””â”€â”€ Database (è¿æ¥æ± )
â”œâ”€â”€ burncloud-common
â”‚   â”œâ”€â”€ types (User, Token)
â”‚   â””â”€â”€ utils (hash_password, generate_token)
â””â”€â”€ external
    â”œâ”€â”€ sqlx            # æ•°æ®åº“è®¿é—®
    â””â”€â”€ serde           # åºåˆ—åŒ–
```
