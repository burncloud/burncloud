# burncloud-server

æ§åˆ¶å¹³é¢ (Control Plane)ï¼Œæä¾› REST API å’Œ LiveView UIã€‚

## ğŸ§… ç¬¬ä¸€å±‚ï¼šç³»ç»Ÿä¸­çš„ä½ç½®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           BurnCloud ç³»ç»Ÿæ¶æ„                                 â”‚
â”‚                                                                              â”‚
â”‚   ç”¨æˆ·è¯·æ±‚                                                                   â”‚
â”‚      â”‚                                                                       â”‚
â”‚      â–¼                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                         ğŸŒ å…¥å£å±‚                                    â”‚    â”‚
â”‚  â”‚                         burncloud                                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚      â”‚                                                                       â”‚
â”‚      â–¼                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚    â”‚
â”‚  â”‚  â”‚   Server    â”‚    â”‚   Router    â”‚    â”‚   Client    â”‚              â”‚    â”‚
â”‚  â”‚  â”‚  (æ§åˆ¶å¹³é¢)  â”‚â—„â”€â”€â”€â”‚  (æ•°æ®å¹³é¢)  â”‚    â”‚  (ç”¨æˆ·ç•Œé¢)  â”‚              â”‚    â”‚
â”‚  â”‚  â”‚             â”‚    â”‚             â”‚    â”‚             â”‚              â”‚    â”‚
â”‚  â”‚  â”‚  â˜… å½“å‰     â”‚    â”‚             â”‚    â”‚             â”‚              â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Server çš„èŒè´£:
â”œâ”€â”€ æä¾› REST API (ç”¨æˆ·/é€šé“/Token/æ—¥å¿—ç®¡ç†)
â”œâ”€â”€ æä¾› LiveView Web UI
â”œâ”€â”€ é…ç½®ç®¡ç†
â””â”€â”€ å¯åŠ¨åå°ä»»åŠ¡ (ä»·æ ¼åŒæ­¥/ç›‘æ§)

ç«¯å£: 3000
```

## ğŸ§… ç¬¬äºŒå±‚ï¼šServer æ•´ä½“é€»è¾‘

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Server æ•´ä½“æ¶æ„                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚                         â”‚  HTTP è¯·æ±‚      â”‚                                 â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                                  â”‚                                          â”‚
â”‚                                  â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                          axum Router                                   â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚   è·¯ç”±åˆ†å‘:                                                             â”‚  â”‚
â”‚  â”‚   /api/*      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  ç®¡ç† API (éœ€è®¤è¯)                         â”‚  â”‚
â”‚  â”‚   /v1/*       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  Router fallback                           â”‚  â”‚
â”‚  â”‚   /*          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  LiveView æˆ–é™æ€æ–‡ä»¶                        â”‚  â”‚
â”‚  â”‚   /_internal/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  å†…éƒ¨ API (å¥åº·æ£€æŸ¥)                       â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                  â”‚                                          â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚         â”‚                        â”‚                        â”‚                 â”‚
â”‚         â–¼                        â–¼                        â–¼                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  REST API   â”‚          â”‚  LiveView   â”‚          â”‚  Router     â”‚          â”‚
â”‚  â”‚             â”‚          â”‚             â”‚          â”‚  Fallback   â”‚          â”‚
â”‚  â”‚  api/*      â”‚          â”‚  Dioxus     â”‚          â”‚             â”‚          â”‚
â”‚  â”‚             â”‚          â”‚  ç»„ä»¶       â”‚          â”‚  æ•°æ®å¹³é¢   â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                          AppState                                      â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ db: Arc<Database>          // æ•°æ®åº“è¿æ¥æ±                        â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ monitor: Arc<System...>    // ç³»ç»Ÿç›‘æ§æœåŠ¡                       â”‚  â”‚
â”‚  â”‚  â””â”€â”€ config: Arc<Config>        // é…ç½®                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§… ç¬¬ä¸‰å±‚ï¼šAPI è·¯ç”±ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              API è·¯ç”±                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  /api/*                                                                      â”‚
â”‚  â”‚                                                                           â”‚
â”‚  â”œâ”€â”€ /auth/*                      # è®¤è¯ (auth.rs)                          â”‚
â”‚  â”‚   â”œâ”€â”€ POST /login             # ç™»å½• â†’ JWT Token                         â”‚
â”‚  â”‚   â”œâ”€â”€ POST /logout            # ç™»å‡º                                     â”‚
â”‚  â”‚   â””â”€â”€ GET  /me                # å½“å‰ç”¨æˆ·ä¿¡æ¯                              â”‚
â”‚  â”‚                                                                           â”‚
â”‚  â”œâ”€â”€ /users/*                     # ç”¨æˆ·ç®¡ç† (user.rs) [éœ€ç®¡ç†å‘˜]           â”‚
â”‚  â”‚   â”œâ”€â”€ GET    /                # åˆ—å‡ºç”¨æˆ·                                 â”‚
â”‚  â”‚   â”œâ”€â”€ POST   /                # åˆ›å»ºç”¨æˆ·                                 â”‚
â”‚  â”‚   â”œâ”€â”€ GET    /:id             # è·å–ç”¨æˆ·                                 â”‚
â”‚  â”‚   â”œâ”€â”€ PUT    /:id             # æ›´æ–°ç”¨æˆ·                                 â”‚
â”‚  â”‚   â””â”€â”€ DELETE /:id             # åˆ é™¤ç”¨æˆ·                                 â”‚
â”‚  â”‚                                                                           â”‚
â”‚  â”œâ”€â”€ /channels/*                  # é€šé“ç®¡ç† (channel.rs)                   â”‚
â”‚  â”‚   â”œâ”€â”€ GET    /                # åˆ—å‡ºé€šé“                                 â”‚
â”‚  â”‚   â”œâ”€â”€ POST   /                # åˆ›å»ºé€šé“                                 â”‚
â”‚  â”‚   â”œâ”€â”€ GET    /:id             # è·å–é€šé“                                 â”‚
â”‚  â”‚   â”œâ”€â”€ PUT    /:id             # æ›´æ–°é€šé“                                 â”‚
â”‚  â”‚   â””â”€â”€ DELETE /:id             # åˆ é™¤é€šé“                                 â”‚
â”‚  â”‚                                                                           â”‚
â”‚  â”œâ”€â”€ /tokens/*                    # Token ç®¡ç† (token.rs)                   â”‚
â”‚  â”‚   â”œâ”€â”€ GET    /                # åˆ—å‡º Token                               â”‚
â”‚  â”‚   â”œâ”€â”€ POST   /                # åˆ›å»º Token (sk-xxxx)                     â”‚
â”‚  â”‚   â””â”€â”€ DELETE /:id             # åˆ é™¤ Token                               â”‚
â”‚  â”‚                                                                           â”‚
â”‚  â”œâ”€â”€ /groups/*                    # åˆ†ç»„ç®¡ç† (group.rs)                     â”‚
â”‚  â”‚   â”œâ”€â”€ GET    /                # åˆ—å‡ºåˆ†ç»„                                 â”‚
â”‚  â”‚   â”œâ”€â”€ POST   /                # åˆ›å»ºåˆ†ç»„                                 â”‚
â”‚  â”‚   â”œâ”€â”€ PUT    /:id             # æ›´æ–°åˆ†ç»„                                 â”‚
â”‚  â”‚   â””â”€â”€ DELETE /:id             # åˆ é™¤åˆ†ç»„                                 â”‚
â”‚  â”‚                                                                           â”‚
â”‚  â”œâ”€â”€ /logs/*                      # æ—¥å¿—æŸ¥è¯¢ (log.rs)                       â”‚
â”‚  â”‚   â”œâ”€â”€ GET    /                # æŸ¥è¯¢æ—¥å¿—                                 â”‚
â”‚  â”‚   â””â”€â”€ GET    /stats           # ç»Ÿè®¡ä¿¡æ¯                                 â”‚
â”‚  â”‚                                                                           â”‚
â”‚  â””â”€â”€ /monitor/*                   # ç³»ç»Ÿç›‘æ§ (monitor.rs)                   â”‚
â”‚      â”œâ”€â”€ GET    /                # ç³»ç»ŸçŠ¶æ€                                 â”‚
â”‚      â”œâ”€â”€ GET    /cpu             # CPU ä½¿ç”¨ç‡                               â”‚
â”‚      â”œâ”€â”€ GET    /memory          # å†…å­˜ä½¿ç”¨                                 â”‚
â”‚      â””â”€â”€ GET    /disk            # ç£ç›˜ä½¿ç”¨                                 â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§… ç¬¬å››å±‚ï¼šæºç ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            server/src/ ç»“æ„                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  lib.rs (å…¥å£)                                                               â”‚
â”‚  â”‚                                                                           â”‚
â”‚  â”œâ”€â”€ æ¨¡å—å¯¼å‡º                                                                â”‚
â”‚  â”‚   â”œâ”€â”€ pub mod api                                                        â”‚
â”‚  â”‚   â””â”€â”€ pub use api::auth::{auth_middleware, Claims}                       â”‚
â”‚  â”‚                                                                           â”‚
â”‚  â”œâ”€â”€ æ ¸å¿ƒç»“æ„                                                                â”‚
â”‚  â”‚   â””â”€â”€ struct AppState                                                    â”‚
â”‚  â”‚       â”œâ”€â”€ db: Arc<Database>                                              â”‚
â”‚  â”‚       â””â”€â”€ monitor: Arc<SystemMonitorService>                             â”‚
â”‚  â”‚                                                                           â”‚
â”‚  â””â”€â”€ æ ¸å¿ƒå‡½æ•°                                                                â”‚
â”‚      â”œâ”€â”€ create_app(db, enable_liveview) â†’ Result<Router>                  â”‚
â”‚      â””â”€â”€ start_server(port, enable_liveview) â†’ Result<()>                  â”‚
â”‚                                                                              â”‚
â”‚  api/                                                                        â”‚
â”‚  â”œâ”€â”€ mod.rs              # æ¨¡å—å®šä¹‰ + routes() å‡½æ•°                         â”‚
â”‚  â”œâ”€â”€ auth.rs             # JWT è®¤è¯                                         â”‚
â”‚  â”œâ”€â”€ user.rs             # ç”¨æˆ·ç®¡ç† API                                     â”‚
â”‚  â”œâ”€â”€ channel.rs          # é€šé“ç®¡ç† API                                     â”‚
â”‚  â”œâ”€â”€ token.rs            # Token ç®¡ç† API                                   â”‚
â”‚  â”œâ”€â”€ group.rs            # åˆ†ç»„ç®¡ç† API                                     â”‚
â”‚  â”œâ”€â”€ log.rs              # æ—¥å¿—æŸ¥è¯¢ API                                     â”‚
â”‚  â””â”€â”€ monitor.rs          # ç³»ç»Ÿç›‘æ§ API                                     â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§… ç¬¬äº”å±‚ï¼šå¯åŠ¨æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              å¯åŠ¨æµç¨‹                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    start_server(port, enable_liveview)
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 1: åˆå§‹åŒ–æ•°æ®åº“                                                        â”‚
â”‚                                                                              â”‚
â”‚  create_default_database()                                                   â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â–¼                                                                    â”‚
â”‚  RouterDatabase::init(&db)    # åˆå§‹åŒ–è·¯ç”±æ•°æ®è¡¨                            â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â–¼                                                                    â”‚
â”‚  UserDatabase::init(&db)      # åˆå§‹åŒ–ç”¨æˆ·æ•°æ®è¡¨                            â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â–¼                                                                    â”‚
â”‚  db = Arc::new(db)            # åŒ…è£…ä¸ºå…±äº«å¼•ç”¨                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 2: å¯åŠ¨åå°ä»»åŠ¡                                                        â”‚
â”‚                                                                              â”‚
â”‚  start_price_sync_task(db, 3600)   # æ¯å°æ—¶ä»·æ ¼åŒæ­¥                         â”‚
â”‚  â””â”€â”€ ä» LiteLLM åŒæ­¥æ¨¡å‹ä»·æ ¼åˆ°æœ¬åœ°æ•°æ®åº“                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 3: åˆ›å»ºåº”ç”¨                                                            â”‚
â”‚                                                                              â”‚
â”‚  create_app(db, enable_liveview)                                             â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â”œâ”€â”€ SystemMonitorService::new()                                     â”‚
â”‚         â”‚    â””â”€â”€ start_auto_update()  # æ¯5ç§’é‡‡é›†ç³»ç»ŸæŒ‡æ ‡                   â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â”œâ”€â”€ api::routes(state)        # æ³¨å†Œç®¡ç† API                        â”‚
â”‚         â”‚    â”œâ”€â”€ auth_middleware      # JWT è®¤è¯ä¸­é—´ä»¶                      â”‚
â”‚         â”‚    â””â”€â”€ å„æ¨¡å—è·¯ç”±                                                  â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â”œâ”€â”€ [if enable_liveview]                                             â”‚
â”‚         â”‚    â””â”€â”€ burncloud_client::liveview_router(db)                      â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â””â”€â”€ create_router_app(db)     # æ•°æ®å¹³é¢ fallback                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 4: å¯åŠ¨æœåŠ¡                                                            â”‚
â”‚                                                                              â”‚
â”‚  axum::serve(listener, app)                                                  â”‚
â”‚                                                                              â”‚
â”‚  ç›‘å¬: 127.0.0.1:{port}                                                      â”‚
â”‚  â”œâ”€â”€ Dashboard: http://127.0.0.1:{port}/                                     â”‚
â”‚  â””â”€â”€ LLM API:   http://127.0.0.1:{port}/v1/...                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§… ç¬¬å…­å±‚ï¼šæ ¸å¿ƒæ¨¡å—è¯¦è§£

### auth.rs - è®¤è¯æ¨¡å—

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              auth.rs                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Claims (JWT è½½è·)                                                     â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  pub struct Claims {                                                   â”‚  â”‚
â”‚  â”‚      pub sub: String,        // ç”¨æˆ· ID                                â”‚  â”‚
â”‚  â”‚      pub username: String,   // ç”¨æˆ·å                                 â”‚  â”‚
â”‚  â”‚      pub role: i32,          // è§’è‰²                                   â”‚  â”‚
â”‚  â”‚      pub exp: usize,         // è¿‡æœŸæ—¶é—´                               â”‚  â”‚
â”‚  â”‚  }                                                                     â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  è§’è‰²å€¼:                                                                â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ 1   = ROLE_COMMON     (æ™®é€šç”¨æˆ·)                                  â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ 10  = ROLE_ADMIN      (ç®¡ç†å‘˜)                                   â”‚  â”‚
â”‚  â”‚  â””â”€â”€ 100 = ROLE_ROOT       (è¶…çº§ç®¡ç†å‘˜)                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  auth_middleware                                                       â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  æµç¨‹:                                                                  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  1. ä» Header æå– Authorization: Bearer {token}                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  2. éªŒè¯ JWT ç­¾å (HS256)                                       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  3. è§£æ Claims                                                 â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  4. æ£€æŸ¥è¿‡æœŸæ—¶é—´ (exp)                                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  5. æ³¨å…¥ Claims åˆ°è¯·æ±‚æ‰©å±•                                      â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  å¤±è´¥ â†’ 401 Unauthorized                                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  æƒé™æ£€æŸ¥å‡½æ•°                                                          â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  require_admin(claims) â†’ Result   // éœ€è¦ç®¡ç†å‘˜æƒé™ (role >= 10)      â”‚  â”‚
â”‚  â”‚  require_root(claims) â†’ Result    // éœ€è¦è¶…çº§ç®¡ç†å‘˜æƒé™ (role >= 100) â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### user.rs - ç”¨æˆ·ç®¡ç†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              user.rs                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  User API Handlers                                                     â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  list_users(State, Query) â†’ Json<Vec<User>>                           â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ åˆ†é¡µæŸ¥è¯¢ (page, per_page)                                         â”‚  â”‚
â”‚  â”‚  â””â”€â”€ è¿‡æ»¤æ¡ä»¶ (group, role)                                            â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  create_user(State, Json<UserInput>) â†’ Json<User>                     â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ éªŒè¯ç”¨æˆ·åå”¯ä¸€æ€§                                                  â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ å¯†ç å“ˆå¸Œ (bcrypt)                                                 â”‚  â”‚
â”‚  â”‚  â””â”€â”€ åˆå§‹åŒ–åŒå¸ç§ä½™é¢                                                  â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  get_user(State, Path<id>) â†’ Json<User>                               â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  update_user(State, Path<id>, Json<UserUpdate>) â†’ Json<User>          â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ æ›´æ–°åŸºæœ¬ä¿¡æ¯                                                      â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ æ›´æ–°å¯†ç  (å¯é€‰ï¼Œéœ€éªŒè¯æ—§å¯†ç )                                     â”‚  â”‚
â”‚  â”‚  â””â”€â”€ æ›´æ–°ä½™é¢ (ä»…ç®¡ç†å‘˜)                                               â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  delete_user(State, Path<id>) â†’ StatusCode                            â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ è½¯åˆ é™¤                                                            â”‚  â”‚
â”‚  â”‚  â””â”€â”€ æ¸…ç†å…³è” Token                                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  User ç»“æ„ (åŒå¸ç§é’±åŒ…):                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  {                                                                     â”‚  â”‚
â”‚  â”‚    "id": "uuid",                                                       â”‚  â”‚
â”‚  â”‚    "username": "string",                                               â”‚  â”‚
â”‚  â”‚    "role": 1,                                                          â”‚  â”‚
â”‚  â”‚    "balance_usd": 1000000000,    // çº³ç¾å…ƒ ($1.00)                    â”‚  â”‚
â”‚  â”‚    "balance_cny": 7200000000,    // çº³ç¾å…ƒç­‰å€¼ (Â¥7.2)                 â”‚  â”‚
â”‚  â”‚    "group": "default",                                                 â”‚  â”‚
â”‚  â”‚    "created_at": "2024-01-01T00:00:00Z"                               â”‚  â”‚
â”‚  â”‚  }                                                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### channel.rs - é€šé“ç®¡ç†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            channel.rs                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Channel API Handlers                                                  â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  list_channels(State) â†’ Json<Vec<Channel>>                            â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  create_channel(State, Json<ChannelInput>) â†’ Json<Channel>            â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ éªŒè¯ base_url æ ¼å¼                                                â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ åŠ å¯†å­˜å‚¨ api_key                                                  â”‚  â”‚
â”‚  â”‚  â””â”€â”€ é…ç½® models åˆ—è¡¨ (é€—å·åˆ†éš”)                                       â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  update_channel(State, Path<id>, Json<ChannelUpdate>)                 â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ æ›´æ–°é…ç½®                                                          â”‚  â”‚
â”‚  â”‚  â””â”€â”€ é‡æ–°åŠ è½½è·¯ç”±å™¨é…ç½®                                                â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  delete_channel(State, Path<id>)                                       â”‚  â”‚
â”‚  â”‚  â””â”€â”€ çº§è”åˆ é™¤ abilities å…³è”                                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  Channel ç»“æ„:                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  {                                                                     â”‚  â”‚
â”‚  â”‚    "id": 1,                                                            â”‚  â”‚
â”‚  â”‚    "name": "OpenAI Official",                                          â”‚  â”‚
â”‚  â”‚    "type": 1,                    // ChannelType æšä¸¾                   â”‚  â”‚
â”‚  â”‚    "key": "sk-***",              // API å¯†é’¥ (åŠ å¯†)                    â”‚  â”‚
â”‚  â”‚    "base_url": "https://api.openai.com",                               â”‚  â”‚
â”‚  â”‚    "models": "gpt-4,gpt-3.5-turbo",                                    â”‚  â”‚
â”‚  â”‚    "group": "default",                                                 â”‚  â”‚
â”‚  â”‚    "priority": 100,                                                    â”‚  â”‚
â”‚  â”‚    "api_version": "2024-01-01",                                        â”‚  â”‚
â”‚  â”‚    "param_override": "{}",       // JSON å‚æ•°è¦†ç›–                      â”‚  â”‚
â”‚  â”‚    "header_override": "{}"       // JSON Header è¦†ç›–                   â”‚  â”‚
â”‚  â”‚  }                                                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  ChannelType æšä¸¾ (éƒ¨åˆ†):                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  OpenAI = 1, Azure = 3, Anthropic = 14, Gemini = 24, VertexAi = 41   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### token.rs - Token ç®¡ç†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                             token.rs                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Token API Handlers                                                    â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  list_tokens(State, Query) â†’ Json<Vec<Token>>                         â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ å¯æŒ‰ user_id è¿‡æ»¤                                                 â”‚  â”‚
â”‚  â”‚  â””â”€â”€ åˆ†é¡µæ”¯æŒ                                                          â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  create_token(State, Json<TokenInput>) â†’ Json<Token>                  â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ ç”Ÿæˆ sk- å‰ç¼€çš„éšæœº Token                                         â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ è®¾ç½®è¿‡æœŸæ—¶é—´ (å¯é€‰)                                               â”‚  â”‚
â”‚  â”‚  â””â”€â”€ è®¾ç½®é…é¢é™åˆ¶                                                      â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  delete_token(State, Path<id>)                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  Token ç»“æ„:                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  {                                                                     â”‚  â”‚
â”‚  â”‚    "id": "uuid",                                                       â”‚  â”‚
â”‚  â”‚    "user_id": "user_uuid",                                             â”‚  â”‚
â”‚  â”‚    "key": "sk-xxxxxxxxxxxxxxxx",      // API Key                      â”‚  â”‚
â”‚  â”‚    "name": "My API Key",             // åç§°                          â”‚  â”‚
â”‚  â”‚    "status": 1,                      // 1=æœ‰æ•ˆ, 0=ç¦ç”¨                 â”‚  â”‚
â”‚  â”‚    "quota_limit": 1000000,           // é…é¢é™åˆ¶ (çº³ç¾å…ƒ)              â”‚  â”‚
â”‚  â”‚    "used_quota": 50000,              // å·²ä½¿ç”¨ (çº³ç¾å…ƒ)                â”‚  â”‚
â”‚  â”‚    "expired_time": null,             // è¿‡æœŸæ—¶é—´ (å¯é€‰)                â”‚  â”‚
â”‚  â”‚    "accessed_time": "2024-01-01"     // æœ€åè®¿é—®æ—¶é—´                   â”‚  â”‚
â”‚  â”‚  }                                                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### log.rs - æ—¥å¿—æŸ¥è¯¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              log.rs                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Log API Handlers                                                      â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  list_logs(State, Query) â†’ Json<Vec<RouterLog>>                       â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ æ—¶é—´èŒƒå›´è¿‡æ»¤ (start_time, end_time)                               â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ ç”¨æˆ·è¿‡æ»¤ (user_id)                                                â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ çŠ¶æ€ç è¿‡æ»¤ (status_code)                                          â”‚  â”‚
â”‚  â”‚  â””â”€â”€ åˆ†é¡µ (page, per_page)                                             â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  get_stats(State, Query) â†’ Json<Stats>                                â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ è¯·æ±‚æ€»é‡                                                          â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ Token ä½¿ç”¨ç»Ÿè®¡                                                    â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ è´¹ç”¨ç»Ÿè®¡                                                          â”‚  â”‚
â”‚  â”‚  â””â”€â”€ å»¶è¿Ÿåˆ†å¸ƒ                                                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  RouterLog ç»“æ„:                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  {                                                                     â”‚  â”‚
â”‚  â”‚    "request_id": "uuid",             // è¯·æ±‚ ID                       â”‚  â”‚
â”‚  â”‚    "user_id": "user_uuid",           // ç”¨æˆ· ID                       â”‚  â”‚
â”‚  â”‚    "path": "/v1/chat/completions",   // è¯·æ±‚è·¯å¾„                      â”‚  â”‚
â”‚  â”‚    "upstream_id": "channel_1",       // ä¸Šæ¸¸é€šé“ ID                   â”‚  â”‚
â”‚  â”‚    "status_code": 200,               // HTTP çŠ¶æ€ç                    â”‚  â”‚
â”‚  â”‚    "latency_ms": 1234,               // å»¶è¿Ÿ (æ¯«ç§’)                   â”‚  â”‚
â”‚  â”‚    "prompt_tokens": 100,             // è¾“å…¥ Token æ•°                 â”‚  â”‚
â”‚  â”‚    "completion_tokens": 200,         // è¾“å‡º Token æ•°                 â”‚  â”‚
â”‚  â”‚    "cost": 0.005,                    // æˆæœ¬ (ç¾å…ƒ)                   â”‚  â”‚
â”‚  â”‚    "created_at": "2024-01-01T00:00:00Z"                               â”‚  â”‚
â”‚  â”‚  }                                                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### monitor.rs - ç³»ç»Ÿç›‘æ§

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            monitor.rs                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Monitor API Handlers                                                  â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  get_system_info(State) â†’ Json<SystemInfo>                            â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ CPU ä½¿ç”¨ç‡                                                        â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ å†…å­˜ä½¿ç”¨                                                          â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ ç£ç›˜ä½¿ç”¨                                                          â”‚  â”‚
â”‚  â”‚  â””â”€â”€ è¿è¡Œæ—¶é—´                                                          â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  get_cpu_usage(State) â†’ Json<CpuInfo>                                 â”‚  â”‚
â”‚  â”‚  get_memory_usage(State) â†’ Json<MemoryInfo>                           â”‚  â”‚
â”‚  â”‚  get_disk_usage(State) â†’ Json<DiskInfo>                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  æ•°æ®æ¥æº:                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  SystemMonitorService (æ¥è‡ª service-monitor)                           â”‚  â”‚
â”‚  â”‚  â”‚                                                                     â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ collectors::cpu     â†’ CPU ä½¿ç”¨ç‡é‡‡é›†                              â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ collectors::memory  â†’ å†…å­˜ä½¿ç”¨é‡‡é›†                                â”‚  â”‚
â”‚  â”‚  â””â”€â”€ collectors::disk    â†’ ç£ç›˜ä½¿ç”¨é‡‡é›†                                â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  è‡ªåŠ¨æ›´æ–°: start_auto_update() æ¯ 5 ç§’é‡‡é›†ä¸€æ¬¡                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§… ç¬¬ä¸ƒå±‚ï¼šæ–‡ä»¶çº§è¯¦è§£

### lib.rs - æ¨¡å—å…¥å£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                               lib.rs                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  æ¨¡å—å£°æ˜:                                                                   â”‚
â”‚  pub mod api;                                                                â”‚
â”‚                                                                              â”‚
â”‚  å…¬å¼€å¯¼å‡º:                                                                   â”‚
â”‚  pub use api::auth::{auth_middleware, Claims};                               â”‚
â”‚                                                                              â”‚
â”‚  æ ¸å¿ƒç»“æ„:                                                                   â”‚
â”‚  pub struct AppState {                                                       â”‚
â”‚      pub db: Arc<Database>,                                                  â”‚
â”‚      pub monitor: Arc<SystemMonitorService>,                                 â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  æ ¸å¿ƒå‡½æ•°:                                                                   â”‚
â”‚  pub async fn create_app(db: Arc<Database>, enable_liveview: bool)          â”‚
â”‚      -> Result<Router>                                                       â”‚
â”‚  // åˆ›å»º axum Router                                                         â”‚
â”‚                                                                              â”‚
â”‚  pub async fn start_server(port: u16, enable_liveview: bool) -> Result<()>  â”‚
â”‚  // å¯åŠ¨ HTTP æœåŠ¡å™¨                                                         â”‚
â”‚                                                                              â”‚
â”‚  å®ç°æµç¨‹:                                                                   â”‚
â”‚  1. åˆå§‹åŒ–æ•°æ®åº“                                                             â”‚
â”‚  2. å¯åŠ¨åå°ä»»åŠ¡ (ä»·æ ¼åŒæ­¥)                                                 â”‚
â”‚  3. åˆ›å»º Router (API + LiveView + Router fallback)                          â”‚
â”‚  4. å¯åŠ¨ axum æœåŠ¡å™¨                                                        â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### api/mod.rs - API æ¨¡å—å®šä¹‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            api/mod.rs                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  æ¨¡å—å£°æ˜:                                                                   â”‚
â”‚  pub mod auth;                                                               â”‚
â”‚  pub mod channel;                                                            â”‚
â”‚  pub mod group;                                                              â”‚
â”‚  pub mod log;                                                                â”‚
â”‚  pub mod monitor;                                                            â”‚
â”‚  pub mod token;                                                              â”‚
â”‚  pub mod user;                                                               â”‚
â”‚                                                                              â”‚
â”‚  è·¯ç”±å®šä¹‰:                                                                   â”‚
â”‚  pub fn routes(state: AppState) -> Router {                                  â”‚
â”‚      Router::new()                                                           â”‚
â”‚          .route("/api/auth/login", post(auth::login))                        â”‚
â”‚          .route("/api/auth/me", get(auth::me))                               â”‚
â”‚          .route("/api/users", get(user::list).post(user::create))           â”‚
â”‚          .route("/api/users/:id", get(user::get).put(user::update)          â”‚
â”‚              .delete(user::delete))                                          â”‚
â”‚          .route("/api/channels", get(channel::list).post(channel::create))  â”‚
â”‚          .route("/api/channels/:id", ...)                                    â”‚
â”‚          .route("/api/tokens", get(token::list).post(token::create))        â”‚
â”‚          .route("/api/groups", get(group::list).post(group::create))        â”‚
â”‚          .route("/api/logs", get(log::list))                                 â”‚
â”‚          .route("/api/monitor", get(monitor::get_system_info))              â”‚
â”‚          .layer(middleware::from_fn_with_state(state, auth_middleware))      â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### api/auth.rs - è®¤è¯æ¨¡å—

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                             api/auth.rs                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  å¸¸é‡:                                                                       â”‚
â”‚  const JWT_SECRET: &str = "secret";        // ç”Ÿäº§ç¯å¢ƒåº”ä»ç¯å¢ƒå˜é‡è¯»å–       â”‚
â”‚  const JWT_EXPIRATION: usize = 86400;      // 24 å°æ—¶                       â”‚
â”‚                                                                              â”‚
â”‚  ç»“æ„ä½“:                                                                     â”‚
â”‚  #[derive(Serialize, Deserialize)]                                           â”‚
â”‚  pub struct Claims {                                                         â”‚
â”‚      pub sub: String,        // ç”¨æˆ· ID                                      â”‚
â”‚      pub username: String,   // ç”¨æˆ·å                                       â”‚
â”‚      pub role: i32,          // è§’è‰² (1/10/100)                             â”‚
â”‚      pub exp: usize,         // è¿‡æœŸæ—¶é—´æˆ³                                   â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  #[derive(Deserialize)]                                                      â”‚
â”‚  struct LoginRequest {                                                       â”‚
â”‚      username: String,                                                       â”‚
â”‚      password: String,                                                       â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  #[derive(Serialize)]                                                        â”‚
â”‚  struct LoginResponse {                                                      â”‚
â”‚      token: String,                                                          â”‚
â”‚      user: User,                                                             â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  API Handlers:                                                               â”‚
â”‚  pub async fn login(State(state), Json(req): Json<LoginRequest>)            â”‚
â”‚      -> Result<Json<LoginResponse>, AppError>                                â”‚
â”‚  // POST /api/auth/login                                                     â”‚
â”‚                                                                              â”‚
â”‚  pub async fn me(State(state), claims: Claims) -> Json<User>                â”‚
â”‚  // GET /api/auth/me                                                         â”‚
â”‚                                                                              â”‚
â”‚  pub async fn logout() -> StatusCode                                        â”‚
â”‚  // POST /api/auth/logout                                                    â”‚
â”‚                                                                              â”‚
â”‚  ä¸­é—´ä»¶:                                                                     â”‚
â”‚  pub async fn auth_middleware(State(state), req: Request, next: Next)       â”‚
â”‚      -> Result<Response, AppError>                                           â”‚
â”‚  // ä» Authorization header æå–å¹¶éªŒè¯ JWT                                  â”‚
â”‚                                                                              â”‚
â”‚  æƒé™æ£€æŸ¥:                                                                   â”‚
â”‚  pub fn require_admin(claims: &Claims) -> Result<(), AppError>              â”‚
â”‚  pub fn require_root(claims: &Claims) -> Result<(), AppError>               â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### api/user.rs - ç”¨æˆ·ç®¡ç† API

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            api/user.rs                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  ç»“æ„ä½“:                                                                     â”‚
â”‚  #[derive(Deserialize)]                                                      â”‚
â”‚  struct CreateUserRequest {                                                  â”‚
â”‚      username: String,                                                       â”‚
â”‚      password: String,                                                       â”‚
â”‚      role: Option<i32>,                                                      â”‚
â”‚      group: Option<String>,                                                  â”‚
â”‚      balance_usd: Option<i64>,                                               â”‚
â”‚      balance_cny: Option<i64>,                                               â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  #[derive(Deserialize)]                                                      â”‚
â”‚  struct UpdateUserRequest {                                                  â”‚
â”‚      username: Option<String>,                                               â”‚
â”‚      password: Option<String>,                                               â”‚
â”‚      role: Option<i32>,                                                      â”‚
â”‚      group: Option<String>,                                                  â”‚
â”‚      balance_usd: Option<i64>,                                               â”‚
â”‚      balance_cny: Option<i64>,                                               â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  #[derive(Deserialize)]                                                      â”‚
â”‚  struct ListUsersQuery {                                                     â”‚
â”‚      page: Option<u32>,                                                      â”‚
â”‚      per_page: Option<u32>,                                                  â”‚
â”‚      group: Option<String>,                                                  â”‚
â”‚      role: Option<i32>,                                                      â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  API Handlers:                                                               â”‚
â”‚  pub async fn list(State(state), Query(q): Query<ListUsersQuery>)           â”‚
â”‚      -> Result<Json<Vec<User>>, AppError>                                    â”‚
â”‚  // GET /api/users?page=1&per_page=20                                        â”‚
â”‚                                                                              â”‚
â”‚  pub async fn create(State(state), claims: Claims,                          â”‚
â”‚      Json(req): Json<CreateUserRequest>) -> Result<Json<User>, AppError>    â”‚
â”‚  // POST /api/users [éœ€ç®¡ç†å‘˜æƒé™]                                           â”‚
â”‚                                                                              â”‚
â”‚  pub async fn get(State(state), Path(id): Path<String>)                     â”‚
â”‚      -> Result<Json<User>, AppError>                                         â”‚
â”‚  // GET /api/users/:id                                                       â”‚
â”‚                                                                              â”‚
â”‚  pub async fn update(State(state), Path(id): Path<String>,                  â”‚
â”‚      claims: Claims, Json(req): Json<UpdateUserRequest>)                    â”‚
â”‚      -> Result<Json<User>, AppError>                                         â”‚
â”‚  // PUT /api/users/:id                                                       â”‚
â”‚                                                                              â”‚
â”‚  pub async fn delete(State(state), Path(id): Path<String>,                  â”‚
â”‚      claims: Claims) -> Result<StatusCode, AppError>                        â”‚
â”‚  // DELETE /api/users/:id [éœ€ç®¡ç†å‘˜æƒé™]                                     â”‚
â”‚                                                                              â”‚
â”‚  ä¸šåŠ¡é€»è¾‘:                                                                   â”‚
â”‚  â€¢ åˆ›å»ºæ—¶å¯†ç å“ˆå¸Œ (bcrypt)                                                   â”‚
â”‚  â€¢ ç”¨æˆ·åå”¯ä¸€æ€§æ£€æŸ¥                                                          â”‚
â”‚  â€¢ ä½™é¢æ›´æ–°ä»…ç®¡ç†å‘˜å¯æ“ä½œ                                                    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### api/channel.rs - é€šé“ç®¡ç† API

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           api/channel.rs                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  ç»“æ„ä½“:                                                                     â”‚
â”‚  #[derive(Deserialize)]                                                      â”‚
â”‚  struct CreateChannelRequest {                                               â”‚
â”‚      name: String,                                                           â”‚
â”‚      type_: i32,                         // ChannelType                     â”‚
â”‚      key: String,                        // API å¯†é’¥                        â”‚
â”‚      base_url: Option<String>,           // ä¸Šæ¸¸åœ°å€                        â”‚
â”‚      models: Vec<String>,                // æ”¯æŒçš„æ¨¡å‹                       â”‚
â”‚      group: String,                      // ç”¨æˆ·ç»„                          â”‚
â”‚      priority: Option<i32>,              // ä¼˜å…ˆçº§                          â”‚
â”‚      api_version: Option<String>,        // API ç‰ˆæœ¬                        â”‚
â”‚      param_override: Option<Value>,      // å‚æ•°è¦†ç›–                        â”‚
â”‚      header_override: Option<Value>,     // Header è¦†ç›–                     â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  API Handlers:                                                               â”‚
â”‚  pub async fn list(State(state)) -> Result<Json<Vec<Channel>>, AppError>    â”‚
â”‚  // GET /api/channels                                                        â”‚
â”‚                                                                              â”‚
â”‚  pub async fn create(State(state), claims: Claims,                          â”‚
â”‚      Json(req): Json<CreateChannelRequest>) -> Result<Json<Channel>, AppError>â”‚
â”‚  // POST /api/channels [éœ€ç®¡ç†å‘˜æƒé™]                                        â”‚
â”‚                                                                              â”‚
â”‚  pub async fn get(State(state), Path(id): Path<i32>)                        â”‚
â”‚      -> Result<Json<Channel>, AppError>                                      â”‚
â”‚  // GET /api/channels/:id                                                    â”‚
â”‚                                                                              â”‚
â”‚  pub async fn update(State(state), Path(id): Path<i32>, ...)                â”‚
â”‚      -> Result<Json<Channel>, AppError>                                      â”‚
â”‚  // PUT /api/channels/:id                                                    â”‚
â”‚                                                                              â”‚
â”‚  pub async fn delete(State(state), Path(id): Path<i32>, ...)                â”‚
â”‚      -> Result<StatusCode, AppError>                                         â”‚
â”‚  // DELETE /api/channels/:id [éœ€ç®¡ç†å‘˜æƒé™]                                  â”‚
â”‚                                                                              â”‚
â”‚  å‰¯ä½œç”¨:                                                                     â”‚
â”‚  â€¢ åˆ›å»º/æ›´æ–°/åˆ é™¤åè§¦å‘è·¯ç”±å™¨é…ç½®é‡è½½                                        â”‚
â”‚  â€¢ åˆ é™¤æ—¶çº§è”åˆ é™¤å…³è”çš„ abilities                                            â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### api/token.rs - Token ç®¡ç† API

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            api/token.rs                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  ç»“æ„ä½“:                                                                     â”‚
â”‚  #[derive(Deserialize)]                                                      â”‚
â”‚  struct CreateTokenRequest {                                                 â”‚
â”‚      user_id: String,                    // æ‰€å±ç”¨æˆ·                        â”‚
â”‚      name: String,                       // Token åç§°                      â”‚
â”‚      quota_limit: Option<i64>,           // é…é¢é™åˆ¶                        â”‚
â”‚      expired_time: Option<String>,       // è¿‡æœŸæ—¶é—´                        â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  #[derive(Deserialize)]                                                      â”‚
â”‚  struct ListTokensQuery {                                                    â”‚
â”‚      user_id: Option<String>,            // æŒ‰ç”¨æˆ·ç­›é€‰                      â”‚
â”‚      page: Option<u32>,                                                       â”‚
â”‚      per_page: Option<u32>,                                                   â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  API Handlers:                                                               â”‚
â”‚  pub async fn list(State(state), Query(q): Query<ListTokensQuery>)          â”‚
â”‚      -> Result<Json<Vec<Token>>, AppError>                                   â”‚
â”‚  // GET /api/tokens?user_id=xxx                                              â”‚
â”‚                                                                              â”‚
â”‚  pub async fn create(State(state), claims: Claims,                          â”‚
â”‚      Json(req): Json<CreateTokenRequest>) -> Result<Json<Token>, AppError>  â”‚
â”‚  // POST /api/tokens                                                         â”‚
â”‚  // ç”Ÿæˆæ ¼å¼: sk-{32ä½éšæœºå­—ç¬¦}                                              â”‚
â”‚                                                                              â”‚
â”‚  pub async fn delete(State(state), Path(id): Path<String>, ...)             â”‚
â”‚      -> Result<StatusCode, AppError>                                         â”‚
â”‚  // DELETE /api/tokens/:id                                                   â”‚
â”‚                                                                              â”‚
â”‚  Token ç”Ÿæˆ:                                                                 â”‚
â”‚  fn generate_token() -> String {                                             â”‚
â”‚      format!("sk-{}", random_string(32))                                     â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### api/group.rs - åˆ†ç»„ç®¡ç† API

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            api/group.rs                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  ç»“æ„ä½“:                                                                     â”‚
â”‚  #[derive(Serialize)]                                                        â”‚
â”‚  struct Group {                                                              â”‚
â”‚      name: String,                       // åˆ†ç»„å                          â”‚
â”‚      member_count: usize,                // æˆå‘˜æ•°é‡                        â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  #[derive(Deserialize)]                                                      â”‚
â”‚  struct CreateGroupRequest {                                                 â”‚
â”‚      name: String,                       // åˆ†ç»„å                          â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  API Handlers:                                                               â”‚
â”‚  pub async fn list(State(state)) -> Result<Json<Vec<Group>>, AppError>      â”‚
â”‚  // GET /api/groups                                                          â”‚
â”‚                                                                              â”‚
â”‚  pub async fn create(State(state), claims: Claims,                          â”‚
â”‚      Json(req): Json<CreateGroupRequest>) -> Result<Json<Group>, AppError>  â”‚
â”‚  // POST /api/groups [éœ€ç®¡ç†å‘˜æƒé™]                                          â”‚
â”‚                                                                              â”‚
â”‚  pub async fn update(State(state), Path(name): Path<String>, ...)           â”‚
â”‚      -> Result<Json<Group>, AppError>                                        â”‚
â”‚  // PUT /api/groups/:name                                                    â”‚
â”‚                                                                              â”‚
â”‚  pub async fn delete(State(state), Path(name): Path<String>, ...)           â”‚
â”‚      -> Result<StatusCode, AppError>                                         â”‚
â”‚  // DELETE /api/groups/:name [éœ€ç®¡ç†å‘˜æƒé™]                                  â”‚
â”‚                                                                              â”‚
â”‚  ç”¨é€”: ç”¨æˆ·åˆ†ç»„ç”¨äºæ§åˆ¶æ¨¡å‹è®¿é—®æƒé™                                          â”‚
â”‚  ä¸åŒåˆ†ç»„å¯è®¿é—®ä¸åŒçš„é€šé“å’Œæ¨¡å‹                                              â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### api/log.rs - æ—¥å¿—æŸ¥è¯¢ API

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                             api/log.rs                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  ç»“æ„ä½“:                                                                     â”‚
â”‚  #[derive(Deserialize)]                                                      â”‚
â”‚  struct ListLogsQuery {                                                      â”‚
â”‚      page: Option<u32>,                                                      â”‚
â”‚      per_page: Option<u32>,                                                  â”‚
â”‚      user_id: Option<String>,            // æŒ‰ç”¨æˆ·ç­›é€‰                      â”‚
â”‚      status_code: Option<i32>,           // æŒ‰çŠ¶æ€ç ç­›é€‰                    â”‚
â”‚      start_time: Option<String>,         // å¼€å§‹æ—¶é—´                        â”‚
â”‚      end_time: Option<String>,           // ç»“æŸæ—¶é—´                        â”‚
â”‚      path: Option<String>,               // è·¯å¾„ç­›é€‰                        â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  #[derive(Serialize)]                                                        â”‚
â”‚  struct LogStats {                                                           â”‚
â”‚      total_requests: u64,                                                    â”‚
â”‚      total_tokens: u64,                                                      â”‚
â”‚      total_cost: f64,                                                        â”‚
â”‚      avg_latency_ms: f64,                                                    â”‚
â”‚      error_rate: f64,                                                        â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  API Handlers:                                                               â”‚
â”‚  pub async fn list(State(state), Query(q): Query<ListLogsQuery>)            â”‚
â”‚      -> Result<Json<Vec<DbRouterLog>>, AppError>                            â”‚
â”‚  // GET /api/logs?start_time=xxx&end_time=xxx                                â”‚
â”‚                                                                              â”‚
â”‚  pub async fn stats(State(state), Query(q): Query<ListLogsQuery>)           â”‚
â”‚      -> Result<Json<LogStats>, AppError>                                     â”‚
â”‚  // GET /api/logs/stats                                                      â”‚
â”‚  // è¿”å›æ±‡æ€»ç»Ÿè®¡ä¿¡æ¯                                                        â”‚
â”‚                                                                              â”‚
â”‚  æ—¥å¿—å­—æ®µ:                                                                   â”‚
â”‚  â€¢ request_id: è¯·æ±‚å”¯ä¸€æ ‡è¯†                                                  â”‚
â”‚  â€¢ user_id: ç”¨æˆ· ID                                                          â”‚
â”‚  â€¢ path: è¯·æ±‚è·¯å¾„                                                            â”‚
â”‚  â€¢ upstream_id: ä¸Šæ¸¸é€šé“                                                     â”‚
â”‚  â€¢ status_code: HTTP çŠ¶æ€ç                                                   â”‚
â”‚  â€¢ latency_ms: å»¶è¿Ÿæ¯«ç§’                                                      â”‚
â”‚  â€¢ prompt_tokens / completion_tokens: Token æ•°                               â”‚
â”‚  â€¢ cost: æˆæœ¬ (ç¾å…ƒ)                                                         â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### api/monitor.rs - ç³»ç»Ÿç›‘æ§ API

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           api/monitor.rs                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  ç»“æ„ä½“:                                                                     â”‚
â”‚  #[derive(Serialize)]                                                        â”‚
â”‚  struct SystemInfo {                                                         â”‚
â”‚      cpu_usage: f64,                     // CPU ä½¿ç”¨ç‡ (%)                  â”‚
â”‚      memory: MemoryInfo,                                                     â”‚
â”‚      disks: Vec<DiskInfo>,                                                   â”‚
â”‚      uptime_secs: u64,                   // è¿è¡Œæ—¶é—´                        â”‚
â”‚      version: String,                    // ç‰ˆæœ¬å·                          â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  #[derive(Serialize)]                                                        â”‚
â”‚  struct MemoryInfo {                                                         â”‚
â”‚      total: u64,                         // æ€»å†…å­˜                          â”‚
â”‚      used: u64,                          // å·²ä½¿ç”¨                          â”‚
â”‚      free: u64,                          // ç©ºé—²                            â”‚
â”‚      usage_percent: f64,                 // ä½¿ç”¨ç‡ (%)                      â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  #[derive(Serialize)]                                                        â”‚
â”‚  struct DiskInfo {                                                           â”‚
â”‚      mount_point: String,                // æŒ‚è½½ç‚¹                          â”‚
â”‚      total: u64,                                                              â”‚
â”‚      used: u64,                                                               â”‚
â”‚      free: u64,                                                               â”‚
â”‚      usage_percent: f64,                                                     â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  API Handlers:                                                               â”‚
â”‚  pub async fn get_system_info(State(state)) -> Json<SystemInfo>             â”‚
â”‚  // GET /api/monitor                                                         â”‚
â”‚                                                                              â”‚
â”‚  pub async fn get_cpu_usage(State(state)) -> Json<CpuInfo>                  â”‚
â”‚  // GET /api/monitor/cpu                                                     â”‚
â”‚                                                                              â”‚
â”‚  pub async fn get_memory_usage(State(state)) -> Json<MemoryInfo>            â”‚
â”‚  // GET /api/monitor/memory                                                  â”‚
â”‚                                                                              â”‚
â”‚  pub async fn get_disk_usage(State(state)) -> Json<Vec<DiskInfo>>           â”‚
â”‚  // GET /api/monitor/disk                                                    â”‚
â”‚                                                                              â”‚
â”‚  æ•°æ®æ¥æº: SystemMonitorService (service-monitor)                            â”‚
â”‚  è‡ªåŠ¨åˆ·æ–°: æ¯ 5 ç§’é‡‡é›†ä¸€æ¬¡                                                   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§… ç¬¬å…«å±‚ï¼šä¾èµ–å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              ä¾èµ–å…³ç³»                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  burncloud-server                                                            â”‚
â”‚  â”œâ”€â”€ burncloud-database          # æ•°æ®åº“                                   â”‚
â”‚  â”‚   â”œâ”€â”€ database-router         # è·¯ç”±æ•°æ®                                 â”‚
â”‚  â”‚   â””â”€â”€ database-user           # ç”¨æˆ·æ•°æ®                                 â”‚
â”‚  â”œâ”€â”€ burncloud-router            # æ•°æ®å¹³é¢ (fallback)                      â”‚
â”‚  â”œâ”€â”€ burncloud-client            # LiveView UI                              â”‚
â”‚  â”œâ”€â”€ burncloud-service-monitor   # ç³»ç»Ÿç›‘æ§                                 â”‚
â”‚  â””â”€â”€ external                                                               â”‚
â”‚      â”œâ”€â”€ axum                    # Web æ¡†æ¶                                 â”‚
â”‚      â”œâ”€â”€ tower-http              # ä¸­é—´ä»¶                                   â”‚
â”‚      â”‚   â””â”€â”€ CorsLayer           # CORS æ”¯æŒ                               â”‚
â”‚      â””â”€â”€ serde_json              # JSON å¤„ç†                                â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
