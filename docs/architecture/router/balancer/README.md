# balancer/

è´Ÿè½½å‡è¡¡æ¨¡å—ï¼Œå®ç°è¯·æ±‚åˆ†å‘ç­–ç•¥ã€‚

## ğŸ§… ç¬¬ä¸€å±‚ï¼šåœ¨ Router ä¸­çš„ä½ç½®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          burncloud-router                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                         è¯·æ±‚å¤„ç†æµç¨‹                                 â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚   proxy_logic() â†’ æ¨¡å‹è·¯ç”± â†’ è·å–å€™é€‰é€šé“åˆ—è¡¨                        â”‚    â”‚
â”‚  â”‚                              â†“                                       â”‚    â”‚
â”‚  â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚    â”‚
â”‚  â”‚                    â”‚     â˜… balancer/         â”‚                      â”‚    â”‚
â”‚  â”‚                    â”‚     é€‰æ‹©æœ€ä¼˜é€šé“        â”‚                      â”‚    â”‚
â”‚  â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚    â”‚
â”‚  â”‚                              â†“                                       â”‚    â”‚
â”‚  â”‚                         è½¬å‘è¯·æ±‚åˆ°é€‰å®šé€šé“                           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

balancer/ çš„èŒè´£:
â”œâ”€â”€ ä»å¤šä¸ªå€™é€‰é€šé“ä¸­é€‰æ‹©ä¸€ä¸ª
â”œâ”€â”€ è½®è¯¢åˆ†å‘ (Round Robin)
â”œâ”€â”€ æƒé‡æ”¯æŒ (æœªæ¥)
â””â”€â”€ çŠ¶æ€æ„ŸçŸ¥é€‰æ‹©
```

## ğŸ§… ç¬¬äºŒå±‚ï¼šæ¨¡å—æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          balancer/ æ•´ä½“æ¶æ„                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚                         â”‚  å€™é€‰é€šé“åˆ—è¡¨   â”‚                                 â”‚
â”‚                         â”‚  [A, B, C, D]   â”‚                                 â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                                  â”‚                                          â”‚
â”‚                                  â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                      RoundRobinBalancer                               â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚   è®¡æ•°å™¨: DashMap<String, AtomicU32>                                 â”‚  â”‚
â”‚  â”‚   æ¯ä¸ªç»„ç‹¬ç«‹è®¡æ•°                                                      â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚   select([A, B, C, D]) â†’ B                                           â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚   åŸç†:                                                               â”‚  â”‚
â”‚  â”‚   counter = 1                                                         â”‚  â”‚
â”‚  â”‚   index = 1 % 4 = 1                                                  â”‚  â”‚
â”‚  â”‚   return candidates[1] = B                                           â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                  â”‚                                          â”‚
â”‚                                  â–¼                                          â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚                         â”‚  é€‰ä¸­çš„é€šé“ B   â”‚                                 â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§… ç¬¬ä¸‰å±‚ï¼šæ–‡ä»¶ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           balancer/ æ–‡ä»¶ç»“æ„                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  crates/router/src/balancer/                                                 â”‚
â”‚  â”‚                                                                           â”‚
â”‚  â””â”€â”€ mod.rs          # RoundRobinBalancer è½®è¯¢è´Ÿè½½å‡è¡¡å™¨                    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§… ç¬¬å››å±‚ï¼šmod.rs è¯¦è§£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              mod.rs                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  pub struct RoundRobinBalancer {                                             â”‚
â”‚      /// æ¯ä¸ªç»„çš„è®¡æ•°å™¨                                                      â”‚
â”‚      /// Key: ç»„å (å¦‚ "default", "vip", etc.)                              â”‚
â”‚      /// Value: åŸå­è®¡æ•°å™¨                                                   â”‚
â”‚      counters: DashMap<String, AtomicU32>,                                   â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  impl RoundRobinBalancer {                                                   â”‚
â”‚      pub fn new() -> Self                                                    â”‚
â”‚      {                                                                       â”‚
â”‚          Self {                                                              â”‚
â”‚              counters: DashMap::new(),                                       â”‚
â”‚          }                                                                   â”‚
â”‚      }                                                                       â”‚
â”‚                                                                              â”‚
â”‚      /// è½®è¯¢é€‰æ‹©æˆå‘˜                                                        â”‚
â”‚      pub fn select<'a>(&self, members: &'a [GroupMember])                   â”‚
â”‚          -> Option<&'a GroupMember>                                          â”‚
â”‚      {                                                                       â”‚
â”‚          if members.is_empty() {                                             â”‚
â”‚              return None;                                                    â”‚
â”‚          }                                                                   â”‚
â”‚                                                                              â”‚
â”‚          // è·å–è®¡æ•°å™¨å¹¶é€’å¢                                                 â”‚
â”‚          let counter = self.counters                                         â”‚
â”‚              .entry("default".to_string())                                   â”‚
â”‚              .or_insert(AtomicU32::new(0));                                  â”‚
â”‚          let index = counter.fetch_add(1, Ordering::Relaxed);                â”‚
â”‚                                                                              â”‚
â”‚          // å–æ¨¡å¾—åˆ°ç´¢å¼•                                                     â”‚
â”‚          Some(&members[index as usize % members.len()])                      â”‚
â”‚      }                                                                       â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  pub struct GroupMember {                                                    â”‚
â”‚      pub upstream_id: String,            // ä¸Šæ¸¸é€šé“ ID                     â”‚
â”‚      pub weight: u32,                    // æƒé‡ (æš‚æœªä½¿ç”¨)                 â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  é€‰æ‹©ç¤ºä¾‹:                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  æˆå‘˜åˆ—è¡¨: [A, B, C, D]                                              â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  ç¬¬1æ¬¡è¯·æ±‚: counter=0, index=0%4=0 â†’ é€‰æ‹© A                         â”‚    â”‚
â”‚  â”‚  ç¬¬2æ¬¡è¯·æ±‚: counter=1, index=1%4=1 â†’ é€‰æ‹© B                         â”‚    â”‚
â”‚  â”‚  ç¬¬3æ¬¡è¯·æ±‚: counter=2, index=2%4=2 â†’ é€‰æ‹© C                         â”‚    â”‚
â”‚  â”‚  ç¬¬4æ¬¡è¯·æ±‚: counter=3, index=3%4=3 â†’ é€‰æ‹© D                         â”‚    â”‚
â”‚  â”‚  ç¬¬5æ¬¡è¯·æ±‚: counter=4, index=4%4=0 â†’ é€‰æ‹© A (å¾ªç¯)                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§… ç¬¬äº”å±‚ï¼šç®—æ³•è¯¦è§£

### ç®€å•è½®è¯¢ (Round Robin)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Round Robin ç®—æ³•                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  ç‰¹ç‚¹:                                                                       â”‚
â”‚  â”œâ”€â”€ å…¬å¹³æ€§: æ¯ä¸ªé€šé“è·å¾—å‡ç­‰çš„è¯·æ±‚æœºä¼š                                     â”‚
â”‚  â”œâ”€â”€ æ— çŠ¶æ€: ä¸éœ€è¦è®°ä½å†å²é€‰æ‹©ç»“æœ                                         â”‚
â”‚  â”œâ”€â”€ O(1) å¤æ‚åº¦: åªéœ€å–æ¨¡è¿ç®—                                              â”‚
â”‚  â””â”€â”€ çº¿ç¨‹å®‰å…¨: ä½¿ç”¨ AtomicU32                                               â”‚
â”‚                                                                              â”‚
â”‚  é€‚ç”¨åœºæ™¯:                                                                   â”‚
â”‚  â”œâ”€â”€ æ‰€æœ‰é€šé“æ€§èƒ½ç›¸è¿‘                                                       â”‚
â”‚  â”œâ”€â”€ æ— éœ€è€ƒè™‘é€šé“è´Ÿè½½                                                       â”‚
â”‚  â””â”€â”€ ç®€å•åœºæ™¯                                                               â”‚
â”‚                                                                              â”‚
â”‚  ä¸é€‚ç”¨åœºæ™¯:                                                                 â”‚
â”‚  â”œâ”€â”€ é€šé“æ€§èƒ½å·®å¼‚å¤§                                                         â”‚
â”‚  â”œâ”€â”€ éœ€è¦åŠ æƒåˆ†å‘                                                           â”‚
â”‚  â””â”€â”€ éœ€è¦æœ€å°‘è¿æ¥æ•°é€‰æ‹©                                                     â”‚
â”‚                                                                              â”‚
â”‚  æµç¨‹å›¾:                                                                     â”‚
â”‚                                                                              â”‚
â”‚       è¯·æ±‚è¿›å…¥                                                               â”‚
â”‚           â”‚                                                                  â”‚
â”‚           â–¼                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                    â”‚
â”‚  â”‚  counter.fetch_add() â”‚                                                    â”‚
â”‚  â”‚  åŸå­é€’å¢è®¡æ•°å™¨      â”‚                                                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                    â”‚
â”‚             â”‚                                                                â”‚
â”‚             â–¼                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                    â”‚
â”‚  â”‚  index = n % len    â”‚                                                    â”‚
â”‚  â”‚  å–æ¨¡å¾—åˆ°ç´¢å¼•        â”‚                                                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                    â”‚
â”‚             â”‚                                                                â”‚
â”‚             â–¼                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                    â”‚
â”‚  â”‚  return members[n]  â”‚                                                    â”‚
â”‚  â”‚  è¿”å›é€‰ä¸­çš„æˆå‘˜      â”‚                                                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æœªæ¥æ‰©å±•: åŠ æƒè½®è¯¢ (Weighted Round Robin)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Weighted Round Robin (æœªæ¥)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  è®¾è®¡:                                                                       â”‚
â”‚  pub struct WeightedRoundRobinBalancer {                                     â”‚
â”‚      counters: DashMap<String, WeightedCounter>,                             â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  struct WeightedCounter {                                                    â”‚
â”‚      current_index: usize,                                                   â”‚
â”‚      current_weight: u32,                                                    â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  ç¤ºä¾‹:                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  æˆå‘˜é…ç½®:                                                           â”‚    â”‚
â”‚  â”‚  A: weight=5, B: weight=3, C: weight=2                              â”‚    â”‚
â”‚  â”‚  æ€»æƒé‡: 10                                                          â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  åˆ†å‘åºåˆ— (10ä¸ªè¯·æ±‚):                                                â”‚    â”‚
â”‚  â”‚  A, A, A, A, A, B, B, B, C, C                                       â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  æ¯”ä¾‹: A=50%, B=30%, C=20%                                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  ç”¨é€”:                                                                       â”‚
â”‚  â”œâ”€â”€ é«˜æ€§èƒ½é€šé“åˆ†é…æ›´å¤šè¯·æ±‚                                                 â”‚
â”‚  â”œâ”€â”€ ä»˜è´¹ç”¨æˆ·é€šé“æƒé‡æ›´é«˜                                                   â”‚
â”‚  â””â”€â”€ æ–°é€šé“é¢„çƒ­æœŸé™ä½æƒé‡                                                   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§… ä¾èµ–å…³ç³»

```
balancer/
â”œâ”€â”€ burncloud-common
â”‚   â””â”€â”€ types (æ— ç›´æ¥ä¾èµ–)
â””â”€â”€ external
    â””â”€â”€ dashmap (çº¿ç¨‹å®‰å…¨ HashMap)
```
