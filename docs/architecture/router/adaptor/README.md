# adaptor/

åè®®é€‚é…å™¨æ¨¡å—ï¼Œå®ç°ä¸åŒ LLM æä¾›å•†ä¹‹é—´çš„åè®®è½¬æ¢ã€‚

## ğŸ§… ç¬¬ä¸€å±‚ï¼šåœ¨ Router ä¸­çš„ä½ç½®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          burncloud-router                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                         æ ¸å¿ƒå¤„ç†æµç¨‹                                 â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚   proxy_handler() â†’ è®¤è¯ â†’ é…é¢ â†’ é™æµ â†’ æ¨¡å‹è·¯ç”± â†’ [adaptor/]</summary>    â”‚    â”‚
â”‚  â”‚                                                              â†“       â”‚    â”‚
â”‚  â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚    â”‚
â”‚  â”‚                    â”‚     â˜… adaptor/          â”‚                      â”‚    â”‚
â”‚  â”‚                    â”‚     åè®®è½¬æ¢             â”‚                      â”‚    â”‚
â”‚  â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚    â”‚
â”‚  â”‚                                                              â†“       â”‚    â”‚
â”‚  â”‚                                           è½¬å‘åˆ°ä¸Šæ¸¸ â†’ å“åº”è½¬æ¢        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

adaptor/ çš„èŒè´£:
â”œâ”€â”€ åè®®è½¬æ¢ (OpenAI â†” Anthropic â†” Gemini â†” Vertex)
â”œâ”€â”€ è¯·æ±‚æ ¼å¼é€‚é…
â”œâ”€â”€ å“åº”æ ¼å¼é€‚é…
â”œâ”€â”€ æµå¼å“åº”è½¬æ¢
â””â”€â”€ åŠ¨æ€åè®®é…ç½®
```

## ğŸ§… ç¬¬äºŒå±‚ï¼šæ¨¡å—æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          adaptor/ æ•´ä½“æ¶æ„                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚                         â”‚   ä¸Šæ¸¸è¯·æ±‚      â”‚                                 â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                                  â”‚                                          â”‚
â”‚                                  â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                      DynamicAdaptorFactory                            â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚   get_adaptor(channel_type, api_version) â†’ Adaptor                   â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚   ç¼“å­˜: DashMap<(ChannelType, Option<String>), Arc<dyn Adaptor>>     â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                  â”‚                                          â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚         â”‚                        â”‚                        â”‚                 â”‚
â”‚         â–¼                        â–¼                        â–¼                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  ClaudeAdaptorâ”‚        â”‚ GeminiAdaptorâ”‚         â”‚ VertexAdaptorâ”‚         â”‚
â”‚  â”‚             â”‚          â”‚             â”‚          â”‚             â”‚          â”‚
â”‚  â”‚ Anthropic   â”‚          â”‚ Google      â”‚          â”‚ GCP Vertex  â”‚          â”‚
â”‚  â”‚ åè®®è½¬æ¢    â”‚          â”‚ åè®®è½¬æ¢    â”‚          â”‚ åè®®è½¬æ¢    â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                        è¾…åŠ©æ¨¡å—                                      â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  mod.rs        - Adaptor trait å®šä¹‰                                  â”‚    â”‚
â”‚  â”‚  dynamic.rs    - åŠ¨æ€åè®®é€‚é… (ä»æ•°æ®åº“åŠ è½½é…ç½®)                     â”‚    â”‚
â”‚  â”‚  detector.rs   - API ç‰ˆæœ¬åºŸå¼ƒæ£€æµ‹                                    â”‚    â”‚
â”‚  â”‚  mapping.rs    - JSON å­—æ®µæ˜ å°„å·¥å…·                                   â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§… ç¬¬ä¸‰å±‚ï¼šæ–‡ä»¶ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            adaptor/ æ–‡ä»¶ç»“æ„                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  crates/router/src/adaptor/                                                  â”‚
â”‚  â”‚                                                                           â”‚
â”‚  â”œâ”€â”€ mod.rs           # æ¨¡å—å…¥å£ï¼ŒAdaptor trait å®šä¹‰                        â”‚
â”‚  â”œâ”€â”€ factory.rs       # DynamicAdaptorFactory åŠ¨æ€é€‚é…å™¨å·¥å‚                â”‚
â”‚  â”œâ”€â”€ dynamic.rs       # DynamicAdaptor è¿è¡Œæ—¶åè®®é€‚é…                       â”‚
â”‚  â”œâ”€â”€ detector.rs      # ApiVersionDetector ç‰ˆæœ¬æ£€æµ‹å™¨                       â”‚
â”‚  â”œâ”€â”€ mapping.rs       # JSON å­—æ®µæ˜ å°„å·¥å…·                                   â”‚
â”‚  â”œâ”€â”€ claude.rs        # ClaudeAdaptor Anthropic é€‚é…å™¨                      â”‚
â”‚  â”œâ”€â”€ gemini.rs        # GeminiAdaptor Google Gemini é€‚é…å™¨                  â”‚
â”‚  â””â”€â”€ vertex.rs        # VertexAdaptor GCP Vertex AI é€‚é…å™¨                  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§… ç¬¬å››å±‚ï¼šå„æ–‡ä»¶è¯¦è§£

### mod.rs

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              mod.rs                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  æ¨¡å—å£°æ˜:                                                                   â”‚
â”‚  pub mod factory;                                                            â”‚
â”‚  pub mod dynamic;                                                            â”‚
â”‚  pub mod detector;                                                           â”‚
â”‚  pub mod mapping;                                                            â”‚
â”‚  pub mod claude;                                                             â”‚
â”‚  pub mod gemini;                                                             â”‚
â”‚  pub mod vertex;                                                             â”‚
â”‚                                                                              â”‚
â”‚  pub use factory::DynamicAdaptorFactory;                                     â”‚
â”‚  pub use claude::ClaudeAdaptor;                                              â”‚
â”‚  pub use gemini::GeminiAdaptor;                                              â”‚
â”‚  pub use vertex::VertexAdaptor;                                              â”‚
â”‚                                                                              â”‚
â”‚  æ ¸å¿ƒ Trait:                                                                 â”‚
â”‚  pub trait Adaptor: Send + Sync {                                            â”‚
â”‚      /// è¿”å›é€šé“ç±»å‹                                                        â”‚
â”‚      fn channel_type(&self) -> ChannelType;                                  â”‚
â”‚                                                                              â”‚
â”‚      /// è½¬æ¢è¯·æ±‚: OpenAI â†’ ä¸Šæ¸¸æ ¼å¼                                         â”‚
â”‚      fn convert_request(&self, req: &OpenAIChatRequest)                     â”‚
â”‚          -> Option<Value>;                                                   â”‚
â”‚                                                                              â”‚
â”‚      /// è½¬æ¢å“åº”: ä¸Šæ¸¸æ ¼å¼ â†’ OpenAI                                         â”‚
â”‚      fn convert_response(&self, resp: Value) -> Option<Value>;              â”‚
â”‚                                                                              â”‚
â”‚      /// è½¬æ¢æµå¼å“åº”å—                                                      â”‚
â”‚      fn convert_stream_response(&self, chunk: &str) -> Option<String>;      â”‚
â”‚                                                                              â”‚
â”‚      /// æ„å»ºè¯·æ±‚                                                            â”‚
â”‚      fn build_request(&self, base_url: &str, req: RequestBuilder,           â”‚
â”‚          body: Value, auth: &AuthConfig) -> RequestBuilder;                 â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### factory.rs

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            factory.rs                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  pub struct DynamicAdaptorFactory {                                          â”‚
â”‚      /// é€‚é…å™¨ç¼“å­˜                                                          â”‚
â”‚      /// Key: (ChannelType, Option<api_version>)                            â”‚
â”‚      /// Value: ç¼“å­˜çš„é€‚é…å™¨å®ä¾‹                                             â”‚
â”‚      cache: DashMap<(ChannelType, Option<String>), Arc<dyn Adaptor>>,       â”‚
â”‚                                                                              â”‚
â”‚      /// æ•°æ®åº“è¿æ¥                                                          â”‚
â”‚      db: Arc<Database>,                                                      â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  impl DynamicAdaptorFactory {                                                â”‚
â”‚      pub fn new(db: Arc<Database>) -> Self                                   â”‚
â”‚                                                                              â”‚
â”‚      /// è·å–é€‚é…å™¨ (å¸¦ç¼“å­˜)                                                 â”‚
â”‚      pub fn get_adaptor(&self, channel_type: ChannelType,                   â”‚
â”‚          api_version: Option<&str>) -> Arc<dyn Adaptor>                     â”‚
â”‚      {                                                                       â”‚
â”‚          // 1. æ£€æŸ¥ç¼“å­˜                                                      â”‚
â”‚          // 2. ç¼“å­˜å‘½ä¸­ â†’ è¿”å›                                               â”‚
â”‚          // 3. ç¼“å­˜æœªå‘½ä¸­ â†’ åˆ›å»ºæ–°é€‚é…å™¨                                     â”‚
â”‚          // 4. å­˜å…¥ç¼“å­˜ â†’ è¿”å›                                               â”‚
â”‚      }                                                                       â”‚
â”‚                                                                              â”‚
â”‚      /// ä½¿ç¼“å­˜å¤±æ•ˆ                                                          â”‚
â”‚      pub fn invalidate_cache(&self, channel_type: ChannelType)              â”‚
â”‚      {                                                                       â”‚
â”‚          // ç§»é™¤æŒ‡å®šç±»å‹çš„æ‰€æœ‰ç¼“å­˜                                           â”‚
â”‚      }                                                                       â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  ç¼“å­˜é”®ç¤ºä¾‹:                                                                 â”‚
â”‚  â”œâ”€â”€ (OpenAI, Some("2024-01-01"))                                           â”‚
â”‚  â”œâ”€â”€ (Anthropic, Some("2023-06-01"))                                        â”‚
â”‚  â”œâ”€â”€ (Gemini, None)                                                          â”‚
â”‚  â””â”€â”€ (VertexAi, None)                                                        â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### dynamic.rs

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           dynamic.rs                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  pub struct DynamicAdaptor {                                                 â”‚
â”‚      /// ä»æ•°æ®åº“åŠ è½½çš„åè®®é…ç½®                                              â”‚
â”‚      config: ProtocolConfig,                                                 â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  pub struct ProtocolConfig {                                                 â”‚
â”‚      pub channel_type: ChannelType,                                          â”‚
â”‚      pub api_version: String,                                                â”‚
â”‚      pub chat_endpoint: String,           // ç«¯ç‚¹æ¨¡æ¿                       â”‚
â”‚      pub request_mapping: Vec<FieldMapping>,                                â”‚
â”‚      pub response_mapping: Vec<FieldMapping>,                               â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  impl Adaptor for DynamicAdaptor {                                           â”‚
â”‚      fn channel_type(&self) -> ChannelType { self.config.channel_type }     â”‚
â”‚                                                                              â”‚
â”‚      fn convert_request(&self, req: &OpenAIChatRequest) -> Option<Value>    â”‚
â”‚      {                                                                       â”‚
â”‚          // 1. åºåˆ—åŒ– OpenAI è¯·æ±‚                                            â”‚
â”‚          // 2. åº”ç”¨å­—æ®µæ˜ å°„                                                  â”‚
â”‚          // 3. è¿”å›è½¬æ¢åçš„ JSON                                             â”‚
â”‚      }                                                                       â”‚
â”‚                                                                              â”‚
â”‚      fn convert_response(&self, resp: Value) -> Option<Value>               â”‚
â”‚      {                                                                       â”‚
â”‚          // 1. åº”ç”¨å“åº”æ˜ å°„                                                  â”‚
â”‚          // 2. è¿”å› OpenAI æ ¼å¼                                              â”‚
â”‚      }                                                                       â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  ç”¨é€”:                                                                       â”‚
â”‚  æ”¯æŒè¿è¡Œæ—¶é…ç½®çš„åè®®è½¬æ¢ï¼Œæ— éœ€é‡æ–°ç¼–è¯‘ä»£ç                                   â”‚
â”‚  é€šè¿‡ database.protocol_configs è¡¨å­˜å‚¨é…ç½®                                  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### detector.rs

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           detector.rs                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  pub struct ApiVersionDetector {                                             â”‚
â”‚      /// åºŸå¼ƒæ¨¡å¼åŒ¹é…è§„åˆ™                                                    â”‚
â”‚      patterns: Vec<DeprecationPattern>,                                      â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  pub struct DeprecationPattern {                                             â”‚
â”‚      pub provider: String,                // æä¾›å•† (OpenAI, Azure, etc.)   â”‚
â”‚      pub pattern: Regex,                  // åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼                  â”‚
â”‚      pub new_version: String,             // æ¨èçš„æ–°ç‰ˆæœ¬                   â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  impl ApiVersionDetector {                                                   â”‚
â”‚      pub fn new() -> Self                                                    â”‚
â”‚                                                                              â”‚
â”‚      /// æ£€æµ‹æ˜¯å¦ä¸ºåºŸå¼ƒç‰ˆæœ¬é”™è¯¯                                              â”‚
â”‚      pub fn is_deprecation_error(&self, error_msg: &str) -> bool            â”‚
â”‚      {                                                                       â”‚
â”‚          // æ£€æŸ¥é”™è¯¯æ¶ˆæ¯æ˜¯å¦åŒ¹é…ä»»ä½•åºŸå¼ƒæ¨¡å¼                                 â”‚
â”‚      }                                                                       â”‚
â”‚                                                                              â”‚
â”‚      /// æ£€æµ‹å¹¶è‡ªåŠ¨æ›´æ–° API ç‰ˆæœ¬                                             â”‚
â”‚      pub async fn detect_and_update(&self, channel_id: i32,                 â”‚
â”‚          error_msg: &str, db: &Database) -> Result<Option<String>>          â”‚
â”‚      {                                                                       â”‚
â”‚          // 1. æ£€æµ‹æ˜¯å¦ä¸ºåºŸå¼ƒé”™è¯¯                                            â”‚
â”‚          // 2. æå–æ¨èæ–°ç‰ˆæœ¬                                                â”‚
â”‚          // 3. æ›´æ–°æ•°æ®åº“ä¸­çš„é€šé“é…ç½®                                        â”‚
â”‚          // 4. è¿”å›æ–°ç‰ˆæœ¬å·                                                  â”‚
â”‚      }                                                                       â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  ç¤ºä¾‹åºŸå¼ƒæ£€æµ‹:                                                               â”‚
â”‚  é”™è¯¯: "This model version is deprecated. Please use 2024-01-01"            â”‚
â”‚  å¤„ç†: è‡ªåŠ¨å°† channel.api_version ä» "2023-05-15" æ›´æ–°åˆ° "2024-01-01"      â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### mapping.rs

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           mapping.rs                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  pub struct FieldMapping {                                                   â”‚
â”‚      pub from: String,                    // æºå­—æ®µè·¯å¾„ (JSONPath)          â”‚
â”‚      pub to: String,                      // ç›®æ ‡å­—æ®µè·¯å¾„                   â”‚
â”‚      pub transform: Option<Transform>,    // å¯é€‰è½¬æ¢å‡½æ•°                   â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  pub enum Transform {                                                        â”‚
â”‚      Identity,                            // ä¸è½¬æ¢                          â”‚
â”‚      Rename(String),                      // é‡å‘½å                          â”‚
â”‚      Format(FormatType),                  // æ ¼å¼åŒ–                          â”‚
â”‚      Custom(String),                      // è‡ªå®šä¹‰è¡¨è¾¾å¼                    â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  /// åº”ç”¨å•ä¸ªæ˜ å°„                                                            â”‚
â”‚  pub fn apply_mapping(value: &Value, mapping: &FieldMapping) -> Value       â”‚
â”‚                                                                              â”‚
â”‚  /// åº”ç”¨å¤šä¸ªæ˜ å°„                                                            â”‚
â”‚  pub fn apply_mappings(value: &Value, mappings: &[FieldMapping]) -> Value   â”‚
â”‚                                                                              â”‚
â”‚  JSONPath ç¤ºä¾‹:                                                              â”‚
â”‚  â”œâ”€â”€ "messages"                  â†’ æ ¹çº§å­—æ®µ                                 â”‚
â”‚  â”œâ”€â”€ "messages[*].content"       â†’ æ•°ç»„æ‰€æœ‰å…ƒç´ çš„ content                   â”‚
â”‚  â”œâ”€â”€ "choices[0].message"        â†’ ç¬¬ä¸€ä¸ªå…ƒç´ çš„ message                     â”‚
â”‚  â””â”€â”€ "metadata.custom"           â†’ åµŒå¥—å­—æ®µ                                 â”‚
â”‚                                                                              â”‚
â”‚  æ˜ å°„ç¤ºä¾‹:                                                                   â”‚
â”‚  { "from": "messages", "to": "contents" }                                   â”‚
â”‚  { "from": "model", "to": "model_id" }                                      â”‚
â”‚  { "from": "max_tokens", "to": "max_tokens_to_sample" }                     â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### claude.rs

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           claude.rs                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  pub struct ClaudeAdaptor;                                                   â”‚
â”‚                                                                              â”‚
â”‚  impl Adaptor for ClaudeAdaptor {                                            â”‚
â”‚      fn channel_type(&self) -> ChannelType { ChannelType::Anthropic }       â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  è¯·æ±‚è½¬æ¢ (OpenAI â†’ Anthropic):                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  OpenAI æ ¼å¼:                        Anthropic æ ¼å¼:                 â”‚    â”‚
â”‚  â”‚  {                                   {                               â”‚    â”‚
â”‚  â”‚    "model": "gpt-4",        â†’         "model": "claude-3-opus",      â”‚    â”‚
â”‚  â”‚    "messages": [...],                "messages": [...],              â”‚    â”‚
â”‚  â”‚    "max_tokens": 1024,               "max_tokens": 1024,             â”‚    â”‚
â”‚  â”‚    "stream": true,                   "stream": true,                 â”‚    â”‚
â”‚  â”‚    "temperature": 0.7                "temperature": 0.7              â”‚    â”‚
â”‚  â”‚  }                                   }                               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  å“åº”è½¬æ¢ (Anthropic â†’ OpenAI):                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Anthropic æ ¼å¼:                     OpenAI æ ¼å¼:                    â”‚    â”‚
â”‚  â”‚  {                                   {                               â”‚    â”‚
â”‚  â”‚    "content": [...],        â†’         "choices": [{                  â”‚    â”‚
â”‚  â”‚    "usage": {...},                     "message": {...},              â”‚    â”‚
â”‚  â”‚    "stop_reason": "end_turn"           "finish_reason": "stop"        â”‚    â”‚
â”‚  â”‚  }                                   }],                              â”‚    â”‚
â”‚  â”‚                                      "usage": {...}                  â”‚    â”‚
â”‚  â”‚                                      }                               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  ç‰¹æ®Šå¤„ç†:                                                                   â”‚
â”‚  â”œâ”€â”€ system æ¶ˆæ¯æå–åˆ°é¡¶å±‚ "system" å­—æ®µ                                    â”‚
â”‚  â”œâ”€â”€ Prompt Caching æ”¯æŒ (cache_control)                                    â”‚
â”‚  â””â”€â”€ æµå¼å“åº”æ ¼å¼è½¬æ¢ (data: {...})                                         â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### gemini.rs

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           gemini.rs                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  pub struct GeminiAdaptor;                                                   â”‚
â”‚                                                                              â”‚
â”‚  impl Adaptor for GeminiAdaptor {                                            â”‚
â”‚      fn channel_type(&self) -> ChannelType { ChannelType::Gemini }          â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  è¯·æ±‚è½¬æ¢ (OpenAI â†’ Gemini):                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  OpenAI æ ¼å¼:                        Gemini æ ¼å¼:                    â”‚    â”‚
â”‚  â”‚  {                                   {                               â”‚    â”‚
â”‚  â”‚    "model": "gpt-4",        â†’         "contents": [{                 â”‚    â”‚
â”‚  â”‚    "messages": [                        "parts": [{"text": "..."}], â”‚    â”‚
â”‚  â”‚      {"role": "user",                   "role": "user"               â”‚    â”‚
â”‚  â”‚       "content": "..."}               }],                            â”‚    â”‚
â”‚  â”‚    ]                                 "generationConfig": {           â”‚    â”‚
â”‚  â”‚  }                                     "temperature": 0.7,           â”‚    â”‚
â”‚  â”‚                                        "maxOutputTokens": 1024      â”‚    â”‚
â”‚  â”‚                                      }                               â”‚    â”‚
â”‚  â”‚                                      }                               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  ç‰¹æ®Šå¤„ç†:                                                                   â”‚
â”‚  â”œâ”€â”€ role æ˜ å°„: user â†’ user, assistant â†’ model                             â”‚
â”‚  â”œâ”€â”€ contents ç»“æ„è½¬æ¢                                                      â”‚
â”‚  â”œâ”€â”€ safetySettings å¯é…ç½®                                                  â”‚
â”‚  â””â”€â”€ generationConfig å‚æ•°æ˜ å°„                                               â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### vertex.rs

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           vertex.rs                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  pub struct VertexAdaptor;                                                   â”‚
â”‚                                                                              â”‚
â”‚  impl Adaptor for VertexAdaptor {                                            â”‚
â”‚      fn channel_type(&self) -> ChannelType { ChannelType::VertexAi }        â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  ç‰¹æ®Šè®¤è¯:                                                                   â”‚
â”‚  â”œâ”€â”€ GCP Service Account JSON                                               â”‚
â”‚  â”œâ”€â”€ OAuth2 Token è·å–å’Œåˆ·æ–°                                                â”‚
â”‚  â””â”€â”€ éœ€è¦é¡¹ç›® ID å’ŒåŒºåŸŸé…ç½®                                                 â”‚
â”‚                                                                              â”‚
â”‚  ç«¯ç‚¹æ ¼å¼:                                                                   â”‚
â”‚  https://{region}-aiplatform.googleapis.com/v1/                             â”‚
â”‚    projects/{project_id}/locations/{region}/                                â”‚
â”‚    publishers/{publisher}/models/{model}:{method}                           â”‚
â”‚                                                                              â”‚
â”‚  ç¤ºä¾‹:                                                                       â”‚
â”‚  https://us-central1-aiplatform.googleapis.com/v1/                          â”‚
â”‚    projects/my-project/locations/us-central1/                               â”‚
â”‚    publishers/google/models/gemini-pro:predict                              â”‚
â”‚                                                                              â”‚
â”‚  æ”¯æŒçš„æ¨¡å‹:                                                                 â”‚
â”‚  â”œâ”€â”€ Gemini on Vertex                                                       â”‚
â”‚  â”œâ”€â”€ Claude on Vertex (Anthropic)                                           â”‚
â”‚  â””â”€â”€ PaLM 2                                                                 â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§… ä¾èµ–å…³ç³»

```
adaptor/
â”œâ”€â”€ burncloud-common
â”‚   â””â”€â”€ types (ChannelType, AuthConfig)
â”œâ”€â”€ burncloud-database
â”‚   â””â”€â”€ protocol_configs è¡¨
â””â”€â”€ external
    â”œâ”€â”€ serde_json
    â”œâ”€â”€ regex
    â””â”€â”€ reqwest
```
