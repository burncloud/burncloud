# service-user

ç”¨æˆ·æœåŠ¡å±‚ï¼Œæä¾›æ³¨å†Œã€ç™»å½•å’Œ Token ç®¡ç†åŠŸèƒ½ã€‚

## ğŸ§… ç¬¬ä¸€å±‚ï¼šåœ¨ Service ä¸­çš„ä½ç½®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          burncloud-service                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚                        æœåŠ¡å±‚                                       â”‚    â”‚
â”‚   â”‚                                                                     â”‚    â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚   â”‚   â”‚ service-monitor â”‚  â”‚â˜…service-user    â”‚  â”‚ service-models  â”‚    â”‚    â”‚
â”‚   â”‚   â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚    â”‚    â”‚
â”‚   â”‚   â”‚ CPU ç›‘æ§        â”‚  â”‚ æ³¨å†Œç™»å½•        â”‚  â”‚ æ¨¡å‹ç®¡ç†        â”‚    â”‚    â”‚
â”‚   â”‚   â”‚ å†…å­˜ç›‘æ§        â”‚  â”‚ JWT Token       â”‚  â”‚ HF é›†æˆ         â”‚    â”‚    â”‚
â”‚   â”‚   â”‚ ç£ç›˜ç›‘æ§        â”‚  â”‚ å¯†ç å“ˆå¸Œ        â”‚  â”‚ æ–‡ä»¶ä¸‹è½½        â”‚    â”‚    â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚   â”‚                                                                     â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

service-user çš„èŒè´£:
â”œâ”€â”€ ç”¨æˆ·æ³¨å†Œ
â”œâ”€â”€ ç”¨æˆ·ç™»å½•
â”œâ”€â”€ JWT Token ç”Ÿæˆå’ŒéªŒè¯
â”œâ”€â”€ å¯†ç å“ˆå¸Œå’ŒéªŒè¯
â””â”€â”€ é»˜è®¤è§’è‰²åˆ†é…
```

## ğŸ§… ç¬¬äºŒå±‚ï¼šæ–‡ä»¶ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       service-user æ–‡ä»¶ç»“æ„                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  crates/service/crates/service-user/                                         â”‚
â”‚  â”‚                                                                           â”‚
â”‚  â”œâ”€â”€ Cargo.toml           # ä¾èµ–é…ç½®                                        â”‚
â”‚  â””â”€â”€ src/                                                                    â”‚
â”‚      â””â”€â”€ lib.rs           # ç”¨æˆ·æœåŠ¡å®ç°                                    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§… ç¬¬ä¸‰å±‚ï¼šlib.rs è¯¦è§£ - æ•°æ®ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          æ•°æ®ç»“æ„å®šä¹‰                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  /// é”™è¯¯ç±»å‹                                                                â”‚
â”‚  pub enum UserServiceError {                                                 â”‚
â”‚      DatabaseError(DatabaseError),     // æ•°æ®åº“é”™è¯¯                        â”‚
â”‚      UserAlreadyExists,                // ç”¨æˆ·å·²å­˜åœ¨                        â”‚
â”‚      UserNotFound,                     // ç”¨æˆ·ä¸å­˜åœ¨                        â”‚
â”‚      InvalidCredentials,               // å¯†ç é”™è¯¯                          â”‚
â”‚      HashError(String),                // å“ˆå¸Œé”™è¯¯                          â”‚
â”‚      TokenError(String),               // Token ç”Ÿæˆé”™è¯¯                    â”‚
â”‚      TokenValidationError(String),     // Token éªŒè¯é”™è¯¯                   â”‚
â”‚      ConfigError(String),              // é…ç½®é”™è¯¯                          â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                                                              â”‚
â”‚  /// è®¤è¯ Token                                                              â”‚
â”‚  pub struct AuthToken {                                                      â”‚
â”‚      pub token: String,       // JWT Token å­—ç¬¦ä¸²                           â”‚
â”‚      pub user_id: String,     // ç”¨æˆ· ID                                    â”‚
â”‚      pub username: String,    // ç”¨æˆ·å                                     â”‚
â”‚      pub expires_at: i64,     // è¿‡æœŸæ—¶é—´æˆ³                                 â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                                                              â”‚
â”‚  /// JWT Claims (å†…éƒ¨ç»“æ„)                                                   â”‚
â”‚  struct Claims {                                                             â”‚
â”‚      sub: String,             // Subject (ç”¨æˆ· ID)                          â”‚
â”‚      username: String,        // ç”¨æˆ·å                                     â”‚
â”‚      exp: i64,                // è¿‡æœŸæ—¶é—´                                    â”‚
â”‚      iat: i64,                // ç­¾å‘æ—¶é—´                                    â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                                                              â”‚
â”‚  /// ç”¨æˆ·æœåŠ¡                                                                â”‚
â”‚  pub struct UserService {                                                    â”‚
â”‚      jwt_secret: String,               // JWT å¯†é’¥                          â”‚
â”‚      token_expiration_hours: i64,      // Token æœ‰æ•ˆæœŸ (å°æ—¶)              â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§… ç¬¬å››å±‚ï¼šæ ¸å¿ƒåŠŸèƒ½ - ç”¨æˆ·æ³¨å†Œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ç”¨æˆ·æ³¨å†Œæµç¨‹                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  pub async fn register_user(                                                 â”‚
â”‚      &self,                                                                  â”‚
â”‚      db: &Database,                                                          â”‚
â”‚      username: &str,                                                         â”‚
â”‚      password: &str,                                                         â”‚
â”‚      email: Option<String>,                                                  â”‚
â”‚  ) -> Result<String>           // è¿”å›ç”¨æˆ· ID                               â”‚
â”‚                                                                              â”‚
â”‚  æµç¨‹:                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  1. æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²å­˜åœ¨                                               â”‚   â”‚
â”‚  â”‚     UserDatabase::get_user_by_username(db, username)                â”‚   â”‚
â”‚  â”‚     â”œâ”€â”€ å­˜åœ¨ â†’ è¿”å› UserAlreadyExists é”™è¯¯                          â”‚   â”‚
â”‚  â”‚     â””â”€â”€ ä¸å­˜åœ¨ â†’ ç»§ç»­                                               â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  2. å“ˆå¸Œå¯†ç                                                          â”‚   â”‚
â”‚  â”‚     bcrypt::hash(password, DEFAULT_COST)                            â”‚   â”‚
â”‚  â”‚     DEFAULT_COST = 12 (bcrypt æ ‡å‡†å¼ºåº¦)                              â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  3. åˆ›å»ºç”¨æˆ·å¯¹è±¡                                                     â”‚   â”‚
â”‚  â”‚     DbUser {                                                        â”‚   â”‚
â”‚  â”‚       id: UUID,                                                     â”‚   â”‚
â”‚  â”‚       username,                                                     â”‚   â”‚
â”‚  â”‚       email,                                                        â”‚   â”‚
â”‚  â”‚       password_hash,                                                â”‚   â”‚
â”‚  â”‚       status: ACTIVE_STATUS (1),                                    â”‚   â”‚
â”‚  â”‚       balance: SIGNUP_BONUS (10.0),                                 â”‚   â”‚
â”‚  â”‚     }                                                               â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  4. ä¿å­˜åˆ°æ•°æ®åº“                                                     â”‚   â”‚
â”‚  â”‚     UserDatabase::create_user(db, &user)                            â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  5. åˆ†é…é»˜è®¤è§’è‰² "user"                                              â”‚   â”‚
â”‚  â”‚     UserDatabase::assign_role(db, &user.id, "user")                 â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  6. è¿”å›ç”¨æˆ· ID                                                      â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§… ç¬¬äº”å±‚ï¼šæ ¸å¿ƒåŠŸèƒ½ - ç”¨æˆ·ç™»å½•

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ç”¨æˆ·ç™»å½•æµç¨‹                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  pub async fn login_user(                                                    â”‚
â”‚      &self,                                                                  â”‚
â”‚      db: &Database,                                                          â”‚
â”‚      username: &str,                                                         â”‚
â”‚      password: &str,                                                         â”‚
â”‚  ) -> Result<AuthToken>        // è¿”å›è®¤è¯ Token                            â”‚
â”‚                                                                              â”‚
â”‚  æµç¨‹:                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  1. æŸ¥è¯¢ç”¨æˆ·                                                         â”‚   â”‚
â”‚  â”‚     UserDatabase::get_user_by_username(db, username)                â”‚   â”‚
â”‚  â”‚     â””â”€â”€ ä¸å­˜åœ¨ â†’ è¿”å› UserNotFound é”™è¯¯                             â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  2. éªŒè¯å¯†ç                                                          â”‚   â”‚
â”‚  â”‚     bcrypt::verify(password, &password_hash)                        â”‚   â”‚
â”‚  â”‚     â””â”€â”€ å¤±è´¥ â†’ è¿”å› InvalidCredentials é”™è¯¯                         â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  3. ç”Ÿæˆ JWT Token                                                   â”‚   â”‚
â”‚  â”‚     generate_token(&user.id, &user.username)                        â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  4. è¿”å› AuthToken                                                   â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§… ç¬¬å…­å±‚ï¼šJWT Token ç®¡ç†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          JWT Token ç®¡ç†                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  /// ç”Ÿæˆ Token                                                              â”‚
â”‚  pub fn generate_token(&self, user_id: &str, username: &str) -> Result<Token>â”‚
â”‚                                                                              â”‚
â”‚  JWT ç»“æ„:                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  Header (Base64):                                                   â”‚   â”‚
â”‚  â”‚  { "alg": "HS256", "typ": "JWT" }                                   â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  Payload (Base64):                                                  â”‚   â”‚
â”‚  â”‚  {                                                                   â”‚   â”‚
â”‚  â”‚    "sub": "user-uuid",        // ç”¨æˆ· ID                            â”‚   â”‚
â”‚  â”‚    "username": "alice",       // ç”¨æˆ·å                             â”‚   â”‚
â”‚  â”‚    "iat": 1709000000,         // ç­¾å‘æ—¶é—´                           â”‚   â”‚
â”‚  â”‚    "exp": 1709086400          // è¿‡æœŸæ—¶é—´ (24å°æ—¶å)                â”‚   â”‚
â”‚  â”‚  }                                                                   â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  Signature (HMAC-SHA256):                                           â”‚   â”‚
â”‚  â”‚  HMACSHA256(base64(header) + "." + base64(payload), secret)         â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                                                              â”‚
â”‚  /// éªŒè¯ Token                                                              â”‚
â”‚  pub fn validate_token(&self, token: &str) -> Result<(String, String)>       â”‚
â”‚  // è¿”å›: (user_id, username)                                               â”‚
â”‚                                                                              â”‚
â”‚  éªŒè¯æµç¨‹:                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  1. è§£ç  Token (éªŒè¯ç­¾å)                                           â”‚   â”‚
â”‚  â”‚  2. æ£€æŸ¥è¿‡æœŸæ—¶é—´ (exp)                                              â”‚   â”‚
â”‚  â”‚  3. æå– Claims                                                      â”‚   â”‚
â”‚  â”‚  4. è¿”å› (sub, username)                                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§… ç¬¬ä¸ƒå±‚ï¼šå¸¸é‡é…ç½®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          å¸¸é‡é…ç½®                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  /// é»˜è®¤ç”¨æˆ·çŠ¶æ€                                                            â”‚
â”‚  const ACTIVE_STATUS: i32 = 1;                                               â”‚
â”‚                                                                              â”‚
â”‚  /// æ–°ç”¨æˆ·æ³¨å†Œå¥–åŠ±                                                          â”‚
â”‚  const SIGNUP_BONUS: f64 = 10.0;                                             â”‚
â”‚  // æ³¨å†Œå³èµ é€ $10 ä½™é¢                                                      â”‚
â”‚                                                                              â”‚
â”‚  /// Token æœ‰æ•ˆæœŸ                                                            â”‚
â”‚  const DEFAULT_TOKEN_EXPIRATION_HOURS: i64 = 24;                             â”‚
â”‚  // JWT Token é»˜è®¤ 24 å°æ—¶åè¿‡æœŸ                                             â”‚
â”‚                                                                              â”‚
â”‚  /// å¯†ç å“ˆå¸Œå¼ºåº¦                                                            â”‚
â”‚  const DEFAULT_COST: u32 = 12;                                               â”‚
â”‚  // bcrypt å“ˆå¸Œè½®æ•°ï¼Œ12 æ˜¯æ¨èçš„å®‰å…¨å¼ºåº¦                                     â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§… ä¾èµ–å…³ç³»

```
service-user
â”œâ”€â”€ burncloud-database
â”‚   â””â”€â”€ Database
â”œâ”€â”€ burncloud-database-user
â”‚   â””â”€â”€ UserDatabase
â””â”€â”€ external
    â”œâ”€â”€ bcrypt           # å¯†ç å“ˆå¸Œ
    â”œâ”€â”€ jsonwebtoken     # JWT å¤„ç†
    â”œâ”€â”€ chrono           # æ—¶é—´å¤„ç†
    â”œâ”€â”€ uuid             # UUID ç”Ÿæˆ
    â”œâ”€â”€ serde            # åºåˆ—åŒ–
    â””â”€â”€ thiserror        # é”™è¯¯å®šä¹‰
```
