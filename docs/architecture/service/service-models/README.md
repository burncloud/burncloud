# service-models

æ¨¡å‹æœåŠ¡å±‚ï¼Œæä¾›æ¨¡å‹ç®¡ç†å’Œ HuggingFace é›†æˆåŠŸèƒ½ã€‚

## ğŸ§… ç¬¬ä¸€å±‚ï¼šåœ¨ Service ä¸­çš„ä½ç½®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          burncloud-service                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚                        æœåŠ¡å±‚                                       â”‚    â”‚
â”‚   â”‚                                                                     â”‚    â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚   â”‚   â”‚ service-monitor â”‚  â”‚ service-user    â”‚  â”‚â˜…service-models  â”‚    â”‚    â”‚
â”‚   â”‚   â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚    â”‚    â”‚
â”‚   â”‚   â”‚ CPU ç›‘æ§        â”‚  â”‚ æ³¨å†Œç™»å½•        â”‚  â”‚ æ¨¡å‹ç®¡ç†        â”‚    â”‚    â”‚
â”‚   â”‚   â”‚ å†…å­˜ç›‘æ§        â”‚  â”‚ JWT Token       â”‚  â”‚ HF é›†æˆ         â”‚    â”‚    â”‚
â”‚   â”‚   â”‚ ç£ç›˜ç›‘æ§        â”‚  â”‚ å¯†ç å“ˆå¸Œ        â”‚  â”‚ æ–‡ä»¶ä¸‹è½½        â”‚    â”‚    â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚   â”‚                                                                     â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

service-models çš„èŒè´£:
â”œâ”€â”€ æ¨¡å‹ CRUD æ“ä½œ
â”œâ”€â”€ HuggingFace API é›†æˆ
â”œâ”€â”€ æ¨¡å‹æ–‡ä»¶åˆ—è¡¨è·å–
â”œâ”€â”€ GGUF æ–‡ä»¶ç­›é€‰
â””â”€â”€ ä¸‹è½½ URL æ„å»º
```

## ğŸ§… ç¬¬äºŒå±‚ï¼šæ–‡ä»¶ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       service-models æ–‡ä»¶ç»“æ„                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  crates/service/crates/service-models/                                       â”‚
â”‚  â”‚                                                                           â”‚
â”‚  â”œâ”€â”€ Cargo.toml           # ä¾èµ–é…ç½®                                        â”‚
â”‚  â””â”€â”€ src/                                                                    â”‚
â”‚      â””â”€â”€ lib.rs           # æ¨¡å‹æœåŠ¡å®ç°                                    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§… ç¬¬ä¸‰å±‚ï¼šlib.rs è¯¦è§£ - æ•°æ®ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          æ•°æ®ç»“æ„å®šä¹‰                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  /// HuggingFace API æ¨¡å‹ä¿¡æ¯                                                â”‚
â”‚  pub struct HfApiModel {                                                     â”‚
â”‚      pub _id: String,                 // å†…éƒ¨ ID                            â”‚
â”‚      pub id: String,                  // æ¨¡å‹ ID (å¦‚ "meta-llama/Llama-2")  â”‚
â”‚      pub likes: Option<i64>,          // ç‚¹èµæ•°                             â”‚
â”‚      pub trending_score: Option<f64>, // çƒ­åº¦åˆ†æ•°                           â”‚
â”‚      pub private: Option<bool>,       // æ˜¯å¦ç§æœ‰                           â”‚
â”‚      pub downloads: Option<i64>,      // ä¸‹è½½é‡                             â”‚
â”‚      pub tags: Option<Vec<String>>,   // æ ‡ç­¾                              â”‚
â”‚      pub pipeline_tag: Option<String>,// ä»»åŠ¡ç±»å‹ (text-generation ç­‰)      â”‚
â”‚      pub library_name: Option<String>,// æ¡†æ¶ (pytorch, safetensors ç­‰)     â”‚
â”‚      pub created_at: Option<String>,  // åˆ›å»ºæ—¶é—´                           â”‚
â”‚      pub model_id: Option<String>,    // æ¨¡å‹æ ‡è¯†                           â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                                                              â”‚
â”‚  /// HuggingFace æ–‡ä»¶é¡¹                                                      â”‚
â”‚  pub struct HfFileItem {                                                     â”‚
â”‚      pub file_type: String,           // "file" æˆ– "directory"              â”‚
â”‚      pub oid: String,                 // æ–‡ä»¶å¯¹è±¡ ID                         â”‚
â”‚      pub size: i64,                   // æ–‡ä»¶å¤§å° (å­—èŠ‚)                     â”‚
â”‚      pub path: String,                // æ–‡ä»¶è·¯å¾„                            â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                                                              â”‚
â”‚  /// æ¨¡å‹æœåŠ¡                                                                â”‚
â”‚  pub struct ModelService {                                                   â”‚
â”‚      db: ModelDatabase,               // åº•å±‚æ•°æ®åº“                         â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§… ç¬¬å››å±‚ï¼šæ ¸å¿ƒåŠŸèƒ½ - æ¨¡å‹ CRUD

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          æ¨¡å‹ CRUD æ“ä½œ                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  /// åˆ›å»ºæ–°çš„æ¨¡å‹æœåŠ¡å®ä¾‹                                                    â”‚
â”‚  pub async fn new() -> Result<Self>                                          â”‚
â”‚                                                                              â”‚
â”‚  /// æ·»åŠ æ¨¡å‹                                                                â”‚
â”‚  pub async fn create(&self, model: &ModelInfo) -> Result<()>                 â”‚
â”‚                                                                              â”‚
â”‚  /// åˆ é™¤æ¨¡å‹ (åŒæ—¶æ¸…ç†æ–‡ä»¶)                                                 â”‚
â”‚  pub async fn delete(&self, model_id: &str) -> Result<()>                    â”‚
â”‚  // 1. è·å–æ¨¡å‹ä¿¡æ¯                                                          â”‚
â”‚  // 2. æ¸…ç†ç‰©ç†æ–‡ä»¶ (cleanup_files)                                          â”‚
â”‚  // 3. åˆ é™¤æ•°æ®åº“è®°å½•                                                        â”‚
â”‚                                                                              â”‚
â”‚  /// æ›´æ–°æ¨¡å‹                                                                â”‚
â”‚  pub async fn update(&self, model: &ModelInfo) -> Result<()>                 â”‚
â”‚  // ä½¿ç”¨ INSERT OR REPLACE è¯­ä¹‰                                              â”‚
â”‚                                                                              â”‚
â”‚  /// æ ¹æ® ID æŸ¥è¯¢æ¨¡å‹                                                        â”‚
â”‚  pub async fn get(&self, model_id: &str) -> Result<Option<ModelInfo>>        â”‚
â”‚                                                                              â”‚
â”‚  /// æŸ¥è¯¢æ‰€æœ‰æ¨¡å‹                                                            â”‚
â”‚  pub async fn list(&self) -> Result<Vec<ModelInfo>>                          â”‚
â”‚                                                                              â”‚
â”‚  /// æ ¹æ®ç®¡é“ç±»å‹æœç´¢                                                        â”‚
â”‚  pub async fn search_by_pipeline(&self, tag: &str) -> Result<Vec<ModelInfo>> â”‚
â”‚                                                                              â”‚
â”‚  /// è·å–çƒ­é—¨æ¨¡å‹                                                            â”‚
â”‚  pub async fn get_popular(&self, limit: i64) -> Result<Vec<ModelInfo>>       â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§… ç¬¬äº”å±‚ï¼šHuggingFace é›†æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          HuggingFace é›†æˆ                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  /// è·å– HuggingFace Host (å¸¦ç¼“å­˜å’Œåœ°åŒºé€‚é…)                                â”‚
â”‚  pub async fn get_huggingface_host() -> Result<String>                       â”‚
â”‚                                                                              â”‚
â”‚  æµç¨‹:                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  1. æŸ¥è¯¢æ•°æ®åº“ç¼“å­˜ (key: "huggingface")                              â”‚   â”‚
â”‚  â”‚     â”œâ”€â”€ å­˜åœ¨ â†’ ç›´æ¥è¿”å›ç¼“å­˜å€¼                                        â”‚   â”‚
â”‚  â”‚     â””â”€â”€ ä¸å­˜åœ¨ â†’ ç»§ç»­                                                â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  2. è·å–ç”¨æˆ·åœ°åŒº                                                     â”‚   â”‚
â”‚  â”‚     service_ip::get_location()                                      â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  3. æ ¹æ®åœ°åŒºé€‰æ‹© Host                                                â”‚   â”‚
â”‚  â”‚     â”œâ”€â”€ "CN" â†’ https://hf-mirror.com/ (å›½å†…é•œåƒ)                    â”‚   â”‚
â”‚  â”‚     â””â”€â”€ å…¶ä»–  â†’ https://huggingface.co/ (å®˜æ–¹)                      â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  4. ä¿å­˜åˆ°æ•°æ®åº“ç¼“å­˜                                                 â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                                                              â”‚
â”‚  /// ä» HuggingFace API è·å–æ¨¡å‹åˆ—è¡¨                                        â”‚
â”‚  pub async fn fetch_from_huggingface() -> Result<Vec<HfApiModel>>            â”‚
â”‚  // GET {host}/api/models                                                   â”‚
â”‚                                                                              â”‚
â”‚  /// è·å–æ¨¡å‹æ–‡ä»¶åˆ—è¡¨ (é€’å½’)                                                 â”‚
â”‚  pub async fn get_model_files(model_id: &str) -> Result<Vec<Vec<String>>>    â”‚
â”‚  // GET {host}/api/models/{model_id}/tree/main                              â”‚
â”‚  // é€’å½’éå†æ‰€æœ‰ç›®å½•                                                         â”‚
â”‚                                                                              â”‚
â”‚  /// ç­›é€‰ GGUF æ–‡ä»¶                                                          â”‚
â”‚  pub fn filter_gguf_files(files: &[Vec<String>]) -> Vec<Vec<String>>         â”‚
â”‚  // è¿‡æ»¤ .gguf åç¼€çš„æ–‡ä»¶                                                   â”‚
â”‚                                                                              â”‚
â”‚  /// æ„å»ºä¸‹è½½ URL                                                            â”‚
â”‚  pub async fn build_download_url(model_id: &str, path: &str) -> Result<String>â”‚
â”‚  // {host}{model_id}/resolve/main/{path}?download=true                      â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§… ç¬¬å…­å±‚ï¼šæ–‡ä»¶æ¸…ç†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          æ–‡ä»¶æ¸…ç†é€»è¾‘                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  /// æ¸…ç†æ¨¡å‹æ–‡ä»¶                                                            â”‚
â”‚  async fn cleanup_files(&self, model_id: &str, filename: Option<&str>)       â”‚
â”‚                                                                              â”‚
â”‚  æ¸…ç†æµç¨‹:                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  1. è·å–æ•°æ®ç›®å½•                                                     â”‚   â”‚
â”‚  â”‚     get_data_dir() â†’ "./data"                                       â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  2. æ„å»ºæ¨¡å‹ç›®å½•è·¯å¾„                                                 â”‚   â”‚
â”‚  â”‚     ./data/{model_id}                                               â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  3. æå–æ–‡ä»¶å‰ç¼€ (å»æ‰ .gguf åç¼€)                                   â”‚   â”‚
â”‚  â”‚     "model-Q4_K_M.gguf" â†’ "model-Q4_K_M"                            â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  4. åˆ é™¤åŒ¹é…å‰ç¼€çš„æ‰€æœ‰æ–‡ä»¶                                           â”‚   â”‚
â”‚  â”‚     åˆ é™¤: model-Q4_K_M.gguf                                         â”‚   â”‚
â”‚  â”‚     åˆ é™¤: model-Q4_K_M.gguf.tmp (ä¸´æ—¶æ–‡ä»¶)                          â”‚   â”‚
â”‚  â”‚     åˆ é™¤: model-Q4_K_M.gguf.part (åˆ†ç‰‡æ–‡ä»¶)                         â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§… ç¬¬ä¸ƒå±‚ï¼šä¸‹è½½é›†æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ä¸‹è½½é›†æˆ                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  /// ä¸‹è½½æ¨¡å‹æ–‡ä»¶                                                            â”‚
â”‚  pub async fn download_model_file(                                           â”‚
â”‚      model_id: &str,                                                         â”‚
â”‚      path: &str,                                                             â”‚
â”‚  ) -> Result<String>           // è¿”å› aria2 ä»»åŠ¡ GID                       â”‚
â”‚                                                                              â”‚
â”‚  æµç¨‹:                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  1. æ„å»ºä¸‹è½½ URL                                                     â”‚   â”‚
â”‚  â”‚     build_download_url(model_id, path)                              â”‚   â”‚
â”‚  â”‚     â†’ https://hf-mirror.com/meta-llama/Llama-2/resolve/main/        â”‚   â”‚
â”‚  â”‚       llama-2-7b.Q4_K_M.gguf?download=true                          â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  2. è·å–ä¸‹è½½ç›®å½•                                                     â”‚   â”‚
â”‚  â”‚     get_data_dir() + model_id                                       â”‚   â”‚
â”‚  â”‚     â†’ ./data/meta-llama/Llama-2                                     â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  3. è°ƒç”¨ä¸‹è½½ç®¡ç†å™¨                                                   â”‚   â”‚
â”‚  â”‚     DownloadManager::add_download(url, download_dir)                â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  4. è¿”å›ä»»åŠ¡ GID                                                     â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§… ä¾èµ–å…³ç³»

```
service-models
â”œâ”€â”€ burncloud-database-models
â”‚   â””â”€â”€ ModelDatabase
â”œâ”€â”€ burncloud-service-setting
â”‚   â””â”€â”€ SettingService
â”œâ”€â”€ burncloud-service-ip
â”‚   â””â”€â”€ get_location()
â”œâ”€â”€ burncloud-download
â”‚   â””â”€â”€ DownloadManager
â””â”€â”€ external
    â”œâ”€â”€ reqwest          # HTTP è¯·æ±‚
    â”œâ”€â”€ serde            # åºåˆ—åŒ–
    â””â”€â”€ tokio            # å¼‚æ­¥è¿è¡Œæ—¶
```
